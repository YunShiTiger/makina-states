

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mc_firewalld / firewalld functions &mdash; Makina States 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Makina States 1.0 documentation" href="../../../../index.html"/>
        <link rel="up" title="modules Modules" href="../../index.html"/>
        <link rel="next" title="mc_golang / golang registry" href="mc_golang.html"/>
        <link rel="prev" title="mc_fail2ban / fail2ban functions" href="mc_fail2ban.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Makina States
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Custom states modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../api/index.html">api Modules</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">modules Modules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="makina_grains.html">makinagrains</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_apache.html">mc_apache / apache httpd functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_apparmor.html">mc_apparmor / apparmor functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_autoupgrade.html">mc_autoupgrade / packages autoupgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_bind.html">mc_bind / named/bind functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_bootstraps.html">mc_bootstraps / bootstraps related registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_burp.html">mc_burp / burp functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_casperjs.html">mc_casperjs / casperjs/npm registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_circus.html">mc_circus / circus functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_compute_node.html">mc_cloud_compute_node / cloud compute node related functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_controller.html">mc_cloud_controller / cloud related variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_docker.html">mc_cloud_docker / docker registry for compute nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_images.html">mc_cloud_images / cloud images release managment &amp; delivery</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_kvm.html">mc_cloud_kvm / kvm registry for compute nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_lxc.html">mc_cloud_lxc / lxc registry for compute nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud.html">mc_cloud / cloud registries &amp; functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_saltify.html">mc_cloud_saltify / cloud related variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cloud_vm.html">mc_cloud_vm / vm registry for compute nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_controllers.html">mc_controllers / controllers related variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_cron.html">mc_cron / cron functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dbsmartbackup.html">mc_dbsmartbackup / db_smart_backup functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dbus.html">mc_dbus / dbus functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dhcpd.html">mc_dhcpd / dhcpd registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_djutils.html">mc_djutils / django helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dnshelpers.html">mc_dnshelpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dns.html">mc_dns / dns settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_dumper.html">mc_dumper / Some useful wrappers to dump/load values</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_editor.html">mc_editor / editor registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_env.html">mc_env / env registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_etckeeper.html">mc_etckeeper</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_etherpad.html">mc_etherpad / etherpad functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_fail2ban.html">mc_fail2ban / fail2ban functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">mc_firewalld / firewalld functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_golang.html">mc_golang / golang registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_grub.html">mc_grub / grub registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_haproxy.html">mc_haproxy / haproxy functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_icinga2.html">mc_icinga2 / icinga functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_icinga.html">mc_icinga / icinga functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_icinga_web2.html">mc_icinga_web2 / icinga_web2 functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_icinga_web.html">mc_icinga_web / icinga_web functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_insserv.html">mc_inssserv / inssserv functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_java.html">mc_java / java registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_kernel.html">mc_kernel / kernel registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ldap.html">mc_ldap / ldap registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_locales.html">mc_locales / locales registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_localsettings.html">mc_localsettings / localsettings variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_locations.html">mc_locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_logrotate.html">mc_logrotate / logrotate registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_lxc.html">mc_lxc / lxc registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_macros.html">mc_macros / macros helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_makinastates.html">mc_makinastates</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_memcached.html">mc_memcached / memcached registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_mongodb.html">mc_mongodb / mongodb functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_monitoring.html">mc_monitoring registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ms_iptables.html">mc_ms_iptables / iptables functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_mumble.html">mc_mumble / mumble registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_mvn.html">mc_mvn / mvn registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_mysql.html">mc_mysql / mysql functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_nagvis.html">mc_nagvis / nagvis functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_network.html">mc_network / network registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_nginx.html">mc_nginx / nginx registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_nodejs.html">mc_nodejs / nodejs/npm registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_nodetypes.html">mc_nodetypes / nodetypes registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_nscd.html">mc_nscd.py / ulogd functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ntp.html">mc_ntp / ntp registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_pgsql.html">mc_pgsql / Postgresql related functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_phantomjs.html">mc_phantomjs / phantomjs/npm registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_php.html">mc_php / php registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_pillar.html">mc_pillar / makinastates ext-pillar</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_pkgs.html">mc_pkgs / pkgs registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_pnp4nagios.html">mc_pnp4nagios / pnp4nagios functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_postfix.html">mc_postfix / postfix functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_project_1.html">mc_project_1 / project settings regitry APIV1</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_project_2.html">mc_project_2 / project settings regitry APIV2</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_project.html">mc_project / project settings regitry switcher and common functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_provider.html">mc_provider / provider functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_proxy.html">mc_proxy / proxy registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_psad.html">mc_psad / psad functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_pureftpd.html">mc_pureftpd / pureftpd functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_python.html">mc_python / python registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_rabbitmq.html">mc_rabbitmq / rabbitmq functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_rdiffbackup.html">mc_rdiff-backup / rdiff-backup functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_redis.html">mc_redis / redis functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_remote_pillar.html">mc_remote_pillar / masterless pillar management</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_remote.html">mc_remote / remote execution functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_rsyslog.html">mc_rsyslog / rsyslog functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_rvm.html">mc_rvm / rvm registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_salt.html">mc_salt / salt related helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_screen.html">mc_screen / screen registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_services_managers.html">mc_services_managers / servives managers registries &amp; functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_services.html">mc_services / servives registries &amp; functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_shorewall.html">mc_shorewall / shorewall functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_slapd.html">mc_slapd / slapd registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_snmpd.html">mc_snmpd / snmpd functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ssh.html">mc_ssh / OpenSSH  related functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ssl.html">mc_ssl / ssl registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_state.html">mc_state / module to execute functions on salt</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_supervisor.html">mc_supervisor / supervisor functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_test.html">mc_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_timezone.html">mc_timezone / timezone registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_tomcat.html">mc_tomcat / tomcat functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ubuntugis.html">mc_ubuntugis / ubuntugis registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_ulogd.html">mc_ulogd / ulogd functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_updatedb.html">mc_updatedb / updatedb functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_usergroup.html">mc_usergroup / usergroup registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_utils.html">mc_utils / Some usefull small tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_uwsgi.html">mc_uwsgi / uwsgi functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_vim.html">mc_vim / vim registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_virtualbox.html">mc_virtualbox / virtualbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc_www.html">mc_www / www registry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../states/index.html">states Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../grains/index.html">grains Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pillars/index.html">pillars Modules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">Makina States</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Custom states modules</a> &raquo;</li>
      
          <li><a href="../../index.html">modules Modules</a> &raquo;</li>
      
    <li>mc_firewalld / firewalld functions</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/api/modules/mc_states/modules/mc_firewalld.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="module-mc_states.modules.mc_firewalld"></span><div class="section" id="mc-firewalld-firewalld-functions">
<span id="module-mc-firewalld"></span><h1>mc_firewalld / firewalld functions<a class="headerlink" href="#mc-firewalld-firewalld-functions" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="mc_states.modules.mc_firewalld.add_aliased_interfaces">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">add_aliased_interfaces</code><span class="sig-paren">(</span><em>data=None</em><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.add_aliased_interfaces" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark aliases of interfaces to belong to the same interface
of the attached interface, by default</p>
</dd></dl>

<dl class="function">
<dt id="mc_states.modules.mc_firewalld.add_natted_networks">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">add_natted_networks</code><span class="sig-paren">(</span><em>data=None</em><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.add_natted_networks" title="Permalink to this definition">¶</a></dt>
<dd><p>Add nat rules if possible on non
public zones</p>
</dd></dl>

<dl class="function">
<dt id="mc_states.modules.mc_firewalld.complete_rich_rules">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">complete_rich_rules</code><span class="sig-paren">(</span><em>rules=None</em>, <em>rule=None</em>, <em>family=None</em>, <em>destinations=None</em>, <em>icmp_block=None</em>, <em>masquerade=None</em>, <em>sources=None</em>, <em>protocols=None</em>, <em>ports=None</em>, <em>forward_ports=None</em>, <em>services=None</em>, <em>endrule=None</em>, <em>audit=None</em>, <em>log=None</em>, <em>log_prefix=None</em>, <em>log_level=None</em>, <em>limit=None</em>, <em>action=None</em><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.complete_rich_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Subroutine of the rich rule helper</p>
</dd></dl>

<dl class="function">
<dt id="mc_states.modules.mc_firewalld.rich_rules">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">rich_rules</code><span class="sig-paren">(</span><em>family='ipv4'</em>, <em>sources=None</em>, <em>source=None</em>, <em>destinations=None</em>, <em>destination=None</em>, <em>services=None</em>, <em>service=None</em>, <em>ports=None</em>, <em>port=None</em>, <em>audit=None</em>, <em>log=None</em>, <em>log_prefix=None</em>, <em>log_level=None</em>, <em>forward_ports=None</em>, <em>forward_port=None</em>, <em>limit=None</em>, <em>icmp_block=None</em>, <em>masquerade=False</em>, <em>action='accept'</em>, <em>public_ips=None</em>, <em>protocols=None</em><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.rich_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to generate rich rules compatibles with firewalld</p>
<p>see firewalld.richlanguage(5) (man)</p>
<dl class="docutils">
<dt>public_ips</dt>
<dd><p class="first">firewalld does make special forward rules relying on packet
marking whenever they macth the port and the source/dest.
This means that it will remap all traffic from an aforementioned rule
matching this port on the public zone to be reentrant and goes to the
destination of the rule instead of the real destination.
Thus to correctly NAT services without limiting outgoing
traffic on the same ports from network branches withing the NAT,
we limit the exposure of the target rules to the public
facing ips of the underlying host.
This also means, that logically, as nearly always with natted
services, network access points from within the NAT
cant access the services as if they would be outside of the NAT.
Technically speaking, in case of forward ports, we only apply the rule
on the public facing address (aka addresses of interfaces which are
linked to the public zones) by limitating the rule scopes to those
destinations.</p>
<p>public_ips is indeed a list of ips, which if empty or None will
be computed from host network informations.</p>
<p class="last">To disable destinations restrictions, you can set public_ips to False.</p>
</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rich_rules</span><span class="p">(</span><span class="n">forward_port</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="s1">&#39;1.2.3.4&#39;</span><span class="p">},</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">)</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">forward_port</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="s1">&#39;1.2.3.4&#39;</span><span class="p">},</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">},</span>
           <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;x.x.x.x&#39;</span><span class="p">)</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">masquerade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;x.x.x.x&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;x.x.x.x&#39;</span><span class="p">)</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;address=&quot;1.2.3.4&quot;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s1">&#39;address=&quot;1.2.3.4&quot;&#39;</span><span class="p">,</span>
           <span class="n">port</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">,</span>
           <span class="n">audit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
           <span class="n">action</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s1">&#39;address=&quot;1.2.3.4&quot;&#39;</span><span class="p">,</span>
           <span class="n">port</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;tcp&#39;</span><span class="p">})</span>
<span class="n">rich_rules</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s1">&#39;address=&quot;1.2.3.4&quot;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">,</span>
           <span class="n">audit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mc_states.modules.mc_firewalld.search_aliased_interfaces">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">search_aliased_interfaces</code><span class="sig-paren">(</span><em>data=None</em><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.search_aliased_interfaces" title="Permalink to this definition">¶</a></dt>
<dd><p>Add public interfaces as candidates for aliased zones
to support common IP Failover scenarii</p>
</dd></dl>

<dl class="function">
<dt id="mc_states.modules.mc_firewalld.settings">
<code class="descclassname">mc_states.modules.mc_firewalld.</code><code class="descname">settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_firewalld.settings" title="Permalink to this definition">¶</a></dt>
<dd><p>firewalld settings</p>
<dl class="docutils">
<dt>makina-states.services.firewalld.enabled</dt>
<dd>set to true to activate firewalld</dd>
<dt>DESIGN</dt>
<dd>all services &amp; forwardport &amp; ports &amp; etc are setted
via rich rules to allow fine-graines selections of source
and destination variations.</dd>
</dl>
<p>GLOBAL SETTINGS</p>
<blockquote>
<div><dl class="docutils">
<dt>permissive_mode</dt>
<dd>force all traffic to be accepted</dd>
<dt>allow_local</dt>
<dd>force all traffic from rfc1918 to be accepted</dd>
<dt>public_interfaces</dt>
<dd>internet faced interfaces</dd>
<dt>internal_interfaces</dt>
<dd>interfaces wired to internal network with no much restriction</dd>
<dt>public_services</dt>
<dd>services to allow</dd>
<dt>restricted_services</dt>
<dd>services to block</dd>
<dt>&lt;XXX&gt;-direct</dt>
<dd>direct rules</dd>
<dt>&lt;XXX&gt;-passthrough</dt>
<dd>direct/passthrough rules (not implemented yet)</dd>
<dt>services</dt>
<dd>list of services to deine</dd>
<dt>zones</dt>
<dd>mapping of zones definitions</dd>
</dl>
</div></blockquote>
<p>PER ZONE SETTINGS</p>
<p>You can configure zone settings via via entries in the zone pillar</p>
<blockquote>
<div><dl class="docutils">
<dt>default_policy</dt>
<dd>enforce policy, attention in firewalld world, everything
is dropped if no match, so no need to force reject.
Its even harmful as it wont cut any further rich rules
to have a change to apply !</dd>
<dt>interfaces</dt>
<dd>interfaces to add to the zone</dd>
<dt>XXX-rules</dt>
<dd>rich rules</dd>
</dl>
</div></blockquote>
<p>For exmeple, to Add some rich rules in pillar to a zone, all
<code class="docutils literal"><span class="pre">makina-states.services.firewall.firewalld.zones.public.rules&lt;id&gt;</span></code>
are merged</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>makina-states.services.firewall.firewalld.zones.public.rules-foo:
  {% for i in salt[&#39;mc_firewalld.rich_rules&#39;](
    port=22, action=&#39;drop&#39;
  )- {{i}} {% endfor %}
  {% for i in salt[&#39;mc_firewalld.rich_rules&#39;](
    forward_port={&#39;port&#39;: 1122, &#39;to_addr&#39;: &#39;1.2.3.4&#39;, &#39;to_port&#39;=22}
  )- {{i}} {% endfor %}
makina-states.services.firewall.firewalld.zones.public.rules-bar:
  - &quot;rule service name=&quot;ftp&quot; log limit value=&quot;1/m&quot; audit accept&quot;
  {% for i in salt[&#39;mc_firewalld.rich_rules&#39;](
    port=22, destinations=[&#39;127.0.0.1&#39;],  action=&#39;drop&#39;
  )- {{i}} {% endfor %}
  {% for i in salt[&#39;mc_firewalld.rich_rules&#39;](
      port=22, destinations=[&#39;not address=&quot;127.0.0.2&quot;&#39;],  action=&#39;drop&#39;
  )- {{i}} {% endfor %}
</pre></div>
</div>
<p>Whitelist some services:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">makina-states.services.firewall.firewalld.public_services-append</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">smtp</span>
</pre></div>
</div>
</div></blockquote>
<p>Change whitelisted services:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">makina-states.services.firewall.firewalld.public_services</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">http</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Define a new service:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">makina-states.services.firewall.firewalld.services.foo</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[{</span><span class="nv">protocol</span><span class="p p-Indicator">:</span> <span class="nv">tcp</span><span class="p p-Indicator">,</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">2222</span><span class="p p-Indicator">}]</span>
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt>NOTE</dt>
<dd><dl class="first last docutils">
<dt><strong>DO NOT ACTIVATE MASQUERADING, IT IS TOO MUCH CATCHY</strong></dt>
<dd>PLEASE USE APPROPRIATE RESTRICTIVES RICH MASQUERADE RULES</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mc_golang.html" class="btn btn-neutral float-right" title="mc_golang / golang registry" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mc_fail2ban.html" class="btn btn-neutral" title="mc_fail2ban / fail2ban functions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 -&gt; 2017, Mathieu Le Marec Pasquet, Régis Leroy &amp; Makina Corpus folks.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>