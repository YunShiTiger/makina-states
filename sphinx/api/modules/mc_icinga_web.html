

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mc_icinga_web / icinga_web functions &mdash; Makina States 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Makina States 1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Execution modules" href="index.html"/>
        <link rel="next" title="mc_java / java registry" href="mc_java.html"/>
        <link rel="prev" title="mc_icinga / icinga functions" href="mc_icinga.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> Makina States</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>
<ul class="simple">
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Custom states modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Execution modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../states/index.html">States modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../grains/index.html">makina-states grains modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">Api  modules</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../v1/index.html">Makina-states V1 documentation (OBSOLETE)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../v1/index.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v1/index.html#reference">Reference</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Makina States</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Custom states modules</a> &raquo;</li>
      
          <li><a href="index.html">Execution modules</a> &raquo;</li>
      
    <li>mc_icinga_web / icinga_web functions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/api/modules/mc_icinga_web.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <span class="target" id="module-mc_states.modules.mc_icinga_web"></span><div class="section" id="mc-icinga-web-icinga-web-functions">
<span id="module-mc-icinga-web"></span><h1>mc_icinga_web / icinga_web functions<a class="headerlink" href="#mc-icinga-web-icinga-web-functions" title="Permalink to this headline">¶</a></h1>
<p>when it is written that &#8220;each key will be treated as a parameter&#8221;,
if you add keys in dictionary, they will be added
in the configuration file with</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;ae:paremeter name=&quot;{{key}}&quot;&gt;{{value}}&lt;/ae:parameter&gt;
</pre></div>
</div>
<p>when it is written that &#8220;foo must be replace with foo value&#8221;, you can
add as many sub-dictionaries as you want. All sub-dictionaries must
have the same structure. It is to avoid a list but in templates
it is treated as if there was a list of dictionaries.</p>
<p>I have prefered</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&#39;foo&#39;: {
    &#39;n1&#39;: {
        &#39;param1&#39;: &quot;v1&quot;,
    },
    &#39;n2&#39;: {
        &#39;param1&#39;: &quot;v2&quot;,
    },
},
</pre></div>
</div>
<p>instead of</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&#39;foo&#39;: [
    {&#39;name&#39;: &quot;n1&quot;,
     &#39;param1&#39;: &quot;v1&quot;,
    },
    {&#39;name&#39;: &quot;n2&quot;,
     &#39;param1&#39;: &quot;v2&quot;,
    },
]
</pre></div>
</div>
<p>When a real list is kept, It is precised below. Generally it is
when the content is not structures but simple values.</p>
<p>The template of xml configuration files use a lot of loops
in order to add content easily but it is not the case with
the ini files where directives are limited and always the same.</p>
<p>The &#8220;nginx&#8221; and &#8220;phpfpm&#8221; sub-dictionaries are given to
macros in **kwargs parameter. If you add a key in,
you can access in the nginx configuration template
or in phpfpm configuration template. In ngin
x subdictionary, the &#8220;icinga_cgi&#8221; and &#8220;icinga_web&#8221;
keys store values used to fill the template.</p>
<p>Otherwise, the first level of subdictionaries is
for distinguish configuration files. There is one
subdictionary per configuration file. The key used
for subdictionary correspond to the name of the file
but the &#8221;.&#8221; is replaced with a &#8220;_&#8221;</p>
<p>I have not found dtd/xsd files in order to verify
grammar of xml files.</p>
<p>Only the hashed password and the salt for the root
account for icinga-web interface are stored in settings.
The hashed password is not computed automatically from an
other value with the clear password (settings
dictionary doesn&#8217;t contains the clear password)</p>
<p>I should add a state to compute the hash from clear
password but I don&#8217;t have successfully done this.</p>
<p>The keys &#8220;has_pgsql&#8221; and &#8220;has_mysql&#8221; determine
if a local postgresql or mysql instance must be installed.
The default value is computed from default database parameters
If the connection is made through a unix pipe
or with the localhost hostname, the booleans are set to True.</p>
<p>The default parameters for icinga_ido database
connection are get from icinga settings.</p>
<p>In the templates, I didn&#8217;t perform a lot of check.
For example if a value must be set only if a other
directive has a precise value, I didn&#8217;t add a if statement.
It is possible to create invalid configuration files.</p>
<p>If in a list, each value must be unique, I tried
to have the elements of the list as dictionary keys.</p>
<p>For optional values which don&#8217;t have a default value,
I didn&#8217;t set them in the default dictionary but in the
templates, I have done:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{% if data.get(&#39;foo&#39;, None) %}
foo={{data.foo}}
{% endif %}
</pre></div>
</div>
<p>Theses optional values corresponds to commented keys in
the default dictionary.</p>
<dl class="function">
<dt id="mc_states.modules.mc_icinga_web.settings">
<code class="descclassname">mc_states.modules.mc_icinga_web.</code><code class="descname">settings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mc_states.modules.mc_icinga_web.settings" title="Permalink to this definition">¶</a></dt>
<dd><p>icinga_web settings</p>
<dl class="docutils">
<dt>location</dt>
<dd>installation directory</dd>
<dt>package</dt>
<dd>list of packages to install icinga-web</dd>
<dt>configuration_directory</dt>
<dd>directory where configuration files are located</dd>
<dt>has_pgsql</dt>
<dd>install and configure a postgresql service in order
to store icinga-web data
(no ido2db data)</dd>
<dt>has_mysql</dt>
<dd>install and configure a mysql service in order to store icinga-web data
(no ido2db data)</dd>
<dt>modules</dt>
<dd><dl class="first last docutils">
<dt>nagvis</dt>
<dd><dl class="first last docutils">
<dt>enable</dt>
<dd>enable the nagvis module which add link to nagvis in icinga-web</dd>
<dt>cronks_xml</dt>
<dd>dictionary to store the cronks. The content is added in
cronks.xml.  The structure is the same that &#8216;cronks_xml&#8217;
subdictionary.</dd>
</dl>
</dd>
<dt>pnp4nagios</dt>
<dd><dl class="first last docutils">
<dt>enable</dt>
<dd>enable the pnp4nagios module which add links to
graphs in icinga-web</dd>
<dt>package</dt>
<dd>package to install for pnp4nagios integration</dd>
<dt>cronks_extensions-templates</dt>
<dd>dictionary in which, each key is the name of an extension
template and the content of the dictionary contains the
values to fill the template
each &#8216;key&#8217;: &#8220;value&#8221; produce
a &#8220;&lt;parameter name={{key}}&gt;{{value}}&lt;/parameter&gt;&#8221;.
The key &#8220;parameter&#8221; or &#8220;parameter_*&#8221; produce
a &#8220;&lt;parameter&gt;&lt;/parameter&gt;&#8221; tag.
Each subdictionary add sub parameters tags.</dd>
</dl>
</dd>
</dl>
</dd>
<dt>root_account</dt>
<dd><p class="first">Dictionary to store root account information.
It is the account created on first installation of icinga_web</p>
<dl class="last docutils">
<dt>login</dt>
<dd>login for root login on web interface</dd>
<dt>hashed_password</dt>
<dd>password for root login on web interface</dd>
<dt>salt</dt>
<dd>salt used to hash the password</dd>
</dl>
</dd>
<dt>databases</dt>
<dd><p class="first">dictionary to store databases connections parameters</p>
<dl class="last docutils">
<dt>ido2db</dt>
<dd><p class="first">dictionary to store ido2db database connection parameters</p>
<dl class="last docutils">
<dt>type</dt>
<dd>type of sgbd used &#8220;pgsql&#8221; or &#8220;mysql&#8221;</dd>
<dt>host</dt>
<dd>host used for connection</dd>
<dt>port</dt>
<dd>port used for connection</dd>
<dt>user</dt>
<dd>user used for connection</dd>
<dt>password</dt>
<dd>password used for connection</dd>
<dt>name</dt>
<dd>database name</dd>
<dt>prefix</dt>
<dd>prefix used in table&#8217;s names</dd>
</dl>
</dd>
<dt>web</dt>
<dd><p class="first">dictionary to store icinga-web database connection parameters</p>
<dl class="last docutils">
<dt>type</dt>
<dd>type of sgbd used &#8220;pgsql&#8221; or &#8220;mysql&#8221;</dd>
<dt>host</dt>
<dd>host used for connection</dd>
<dt>port</dt>
<dd>port used for connection</dd>
<dt>user</dt>
<dd>user used for connection</dd>
<dt>password</dt>
<dd>password used for connection</dd>
<dt>name</dt>
<dd>database name</dd>
</dl>
</dd>
<dt>nginx</dt>
<dd><p class="first">dictionary to store values of nginx configuration</p>
<dl class="last docutils">
<dt>domain</dt>
<dd>name of virtualhost created to serve webpages</dd>
<dt>doc_root</dt>
<dd>root location of virtualhost</dd>
<dt>vh_content_source</dt>
<dd>template file for nginx content file</dd>
<dt>vh_top_source</dt>
<dd>template file for nginx top file</dd>
<dt>icinga_web</dt>
<dd><p class="first">dictionary to store values used in templates given in
vh_content_source and vh_top_source</p>
<dl class="last docutils">
<dt>web_directory</dt>
<dd>location under which webpages of icinga-web will be
available</dd>
<dt>images_dir</dt>
<dd>directory where images used by icinga-web are stored</dd>
<dt>styles_dir</dt>
<dd>directory where css used by icinga-web are stored</dd>
<dt>bpaddon_dir</dt>
<dd>directory where bpaddon scripts are located</dd>
<dt>ext3_dir</dt>
<dd>directory where ext3 scripts are located</dd>
<dt>fastcgi_pass</dt>
<dd>socket used to contact fastcgi server in order to
interpret php files</dd>
</dl>
</dd>
</dl>
</dd>
<dt>phpfpm</dt>
<dd><p class="first">dictionary to store values of phpfpm configuration</p>
<dl class="last docutils">
<dt>open_basedir</dt>
<dd>paths to add to open_basedir</dd>
<dt>extensions_package</dt>
<dd>additional packages to install (such as php5-pgsql
or php5-mysql for
php database connection)</dd>
<dt>doc_root</dt>
<dd>root location for php-fpm</dd>
<dt>session_auto_start</dt>
<dd>must be 0 to run icinga-web</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mc_java.html" class="btn btn-neutral float-right" title="mc_java / java registry">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mc_icinga.html" class="btn btn-neutral" title="mc_icinga / icinga functions"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 -&gt; 2017, Mathieu Le Marec Pasquet, Régis Leroy &amp; Makina Corpus folks.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>