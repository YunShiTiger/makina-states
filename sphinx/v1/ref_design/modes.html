

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execution modes &mdash; Makina States 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Makina States 1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Misc &amp; Obsolete" href="../ref_obsolete.html"/>
        <link rel="next" title="Macros" href="macros.html"/>
        <link rel="prev" title="ubuntu log to package and get PPA for a package" href="../ref_packaging/index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> Makina States</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>
<ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Custom states modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/modules/index.html">Execution modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/states/index.html">States modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/grains/index.html">makina-states grains modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/api/index.html">Api  modules</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Makina-states V1 documentation (OBSOLETE)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#usage">Usage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#reference">Reference</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Makina States</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Makina-states V1 documentation (OBSOLETE)</a> &raquo;</li>
      
          <li><a href="../ref_index.html">Reference</a> &raquo;</li>
      
          <li><a href="../ref_obsolete.html">Misc &amp; Obsolete</a> &raquo;</li>
      
    <li>Execution modes</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/v1/ref_design/modes.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="execution-modes">
<h1>Execution modes<a class="headerlink" href="#execution-modes" title="Permalink to this headline">¶</a></h1>
<p><strong>OBSOLETE</strong> We do not use that much execution modes, prefer to split your formulaes in small chunks.
See for example the &#8220;makina-states.services.monitoring.supervisor&#8221; state.</p>
<p>As we now extensivly use auto inclusion, we are particularly exposed to the <strong>state bloat megalomania</strong> when including a small little state will make rebuild the most part of makina-states. To prevent this, there are 2 main modes of execution and when the full mode will configure from end to end your machine, the standalone mode will skip most of the included states but also some of your currently called sls file.</p>
<p>The main use case is that the first time, you need to install a project and do a lot of stuff, but on the other runs, you just need to pull your new changesets and reload apache.
The full mode is the standart mode, and the <strong>light</strong> mode is called <strong>standalone</strong>.
That&#8217;s why you ll see most formulaes declined in two sls flavors.</p>
<p>By convention, in those formulaes, we make the <strong>standalone</strong> one as a macro taking at least a <strong>full</strong> boolean parameter and then call it at the end with <strong>full=false</strong>. Then we write the normal sls calling this same little macro with <strong>full=true</strong>.</p>
<p>It is then up to the user of in the other sls includes to choose which sls to apply for the specific use case.</p>
<p>For example, consider the following sls files</p>
<ul>
<li><p class="first">/srv/salt/makina-states/services/awesome/mysuperservice-standalone.sls:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{% macro do(full=True) %}
{% if full %}
OneLongStep:
    super.long: []
{% endif %}

OneShortStep:
    super.short []
{% endmacro %}
{{ do(full=False) }}
</pre></div>
</div>
</li>
<li><p class="first">/srv/salt/makina-states/services/awesome/mysuperservice.sls:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{% import &quot;makina-states/services/awesome/mysuperservice-standalone.sls&quot; as base with context %}
{{ do(full=True) }}
</pre></div>
</div>
</li>
</ul>
<p>By hand, i will do the first time:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>salt-call -lall makina-states.services.awesome.mysuperservice
</pre></div>
</div>
<p>And in a second time:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>salt-call -lall makina-states.services.awesome.mysuperservice-standalone
</pre></div>
</div>
<p>As you can guess, OneLongStep will only be called the first time, and OneShortStep will be called both time.</p>
<p>Now, to make the inclusion dynamic in an intermediary sls file, you can also do a condtionnal include:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>include:
    {% if cond %}
    - makina-states.services.awesome.mysuperservice-standalone
    {% else %}
    - makina-states.services.awesome.mysuperservice
    {% endif %}
</pre></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="macros.html" class="btn btn-neutral float-right" title="Macros">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../ref_packaging/index.html" class="btn btn-neutral" title="ubuntu log to package and get PPA for a package"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 -&gt; 2017, Mathieu Le Marec Pasquet, Régis Leroy &amp; Makina Corpus folks.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>