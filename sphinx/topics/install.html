

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &amp; basic usage &mdash; Makina States 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Makina States 1.0 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Makina States</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Makina States</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Installation &amp; basic usage</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/topics/install.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="installation-basic-usage">
<h1>Installation &amp; basic usage<a class="headerlink" href="#installation-basic-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="briefing">
<h2>Briefing<a class="headerlink" href="#briefing" title="Permalink to this headline">¶</a></h2>
<p><strong>For now, use Ubuntu &gt;= 14.04.</strong>.
Makina-States can be ported to any linux based OS,
but we here use ubuntu server and this is the only supported system for now.
It can be used in any flavor, lxc, docker, baremetal, kvm, etc.</p>
<p>To install our base salt installation, you have to choose between different modes of operations
tweakable via the <strong>nodetype</strong> setting:</p>
<blockquote>
<div><ul class="simple">
<li>The regular preset modes manages the system configuration from end to end, from
the system, to makina-states, including the saltstack/salt/ansible installation
itself.</li>
<li>The special <code class="docutils literal"><span class="pre">scratch</span></code> mode manages only the saltstack + makina-states
configuration by default, so it&#8217;s up to you to apply any other state
but do not touch much to the system itself more than installing the
scripts for wiring makina-states</li>
</ul>
</div></blockquote>
<p><strong>Makina-states do not use regular salt daemons to operate remotely
but an ansible bridge that copy the pillar and use salt-call locally
directly on the remote box</strong></p>
</div>
<div class="section" id="reminder">
<h2>Reminder<a class="headerlink" href="#reminder" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Makina-states is based on &#8220;nodetypes presets&#8221; that are prebundled
collections of makina-states states to apply to the system.</li>
<li>On those nodetypes, we manage &#8220;controllers&#8221;, aka the states which configure
salt &amp; ansible for operation</li>
<li>On those nodetypes, we may configure &#8220;localsettings&#8221; like ssl, vim, git, &amp;
basepackages or network configurations. If any other preset than <strong>scratch</strong>
has been activated, many localsettings will be applied by default (see
mc_states/modules/localsettings.py:registry)</li>
<li>After all of the previous steps, we may configure services like sshd,
crond, or databases. If we are on the <strong>scratch</strong> mode, no services
are configured by default.</li>
<li>Eventually, we may by able to install projects via mc_project.
A project is just a classical code repository which has a &#8221;.salt&#8221; and/or
ansible playbooks/roles folder commited with enougth information on how
to deploy it.</li>
</ul>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p>Just run the <strong>_scrits/boot-salt.sh</strong> script as <strong>root</strong>,</p>
<p>Please read next paragraphs before running any command.</p>
<ul>
<li><p class="first">All the behavior of the script can be controlled via environment variables or command line arguments switches.</p>
</li>
<li><p class="first">You will need to tell on what kind of environment you are installing on (the nodetype).</p>
</li>
<li><p class="first">You&#8217;ll also have to set the <strong>minion id</strong>. The default choice for <strong>&#8211;minion-id</strong> is the current machine hostname.
You should keep this naming scheme unless you have a good reason to change it.</p>
</li>
<li><p class="first">Your choice for <code class="docutils literal"><span class="pre">\-\-nodetype</span></code> is certainly one of:</p>
<blockquote>
<div><ul class="simple">
<li><strong>scratch</strong> manages by default only the salt installation and configuration.
You ll want to activate this mode if you want to apply explicitly your
states without relying of default nodetypes configuration.</li>
<li><strong>server (default)</strong> matches a baremetal server, and manage it from end to end (base
packages, network, locales, sshd, crond, logrotate, etc, by default)</li>
<li><strong>vm</strong> matches a VM (not baremetal), this is mostly like <strong>server</strong>.</li>
<li><strong>lxccontainer</strong> matches a VM (not baremetal), this is mostly like <strong>server</strong>.</li>
<li><strong>laptop</strong> is like server but also install packages for working on a
developement machine (prebacking a laptop for a dev)</li>
<li><strong>dockercontainer</strong> matches a VM (not baremetal), this is mostly like <strong>server</strong>, but install &amp; preconfigure circus to manage daemons.</li>
<li><strong>devhost</strong> is suitable for a development machine enabling states to act on that,
by example installation of a test local-loop mailer.</li>
<li><strong>vagrantvm</strong> is suitable to flag vagrant boxes and is a subtype of
devhost</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="regular-modes-via-boot-salt-sh">
<span id="project-regular-modes"></span><h2>Regular modes (via boot-salt.sh)<a class="headerlink" href="#regular-modes-via-boot-salt-sh" title="Permalink to this headline">¶</a></h2>
<p>boot-salt.sh will try to remember how you configured makina-states on each run.
It stores configs in :</p>
<blockquote>
<div><ul class="simple">
<li>installdir/etc/makina-states</li>
</ul>
</div></blockquote>
<p>Indeed while running, the script try to find enougth information (nodetype, salt installs, branch),
and will automaticly guess &amp; store the parameters by itself.</p>
<p>In other words, you will just have to type <strong>boot-salt.sh</strong>, and verify settings the next time you ll use it.</p>
<p><strong>REMEMBER THAT FOR NOW YOU HAVE TO USE UBUNTU &gt;= 14.04.</strong></p>
<div class="section" id="download">
<h3>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h3>
<p>Get the script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>wget http://raw.github.com/makinacorpus/makina-states/v2/_scripts/boot-salt.sh
</pre></div>
</div>
<p>Short overview:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh --help
</pre></div>
</div>
<p>Detailed overview:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh --long-help
</pre></div>
</div>
</div>
<div class="section" id="cli-exemples">
<h3>CLI Exemples<a class="headerlink" href="#cli-exemples" title="Permalink to this headline">¶</a></h3>
<p>If you want to install only a minion which will be connected to a remote
mastersalt master:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh
</pre></div>
</div>
<p>If you want to install salt on a machine flaggued as a devhost (server + dev mode):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh --n devhost
</pre></div>
</div>
<p>If you want to manage from end to end your server, select also the <code class="docutils literal"><span class="pre">laptop</span></code> preset
nodetype:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh -n laptop
</pre></div>
</div>
<p>To skip the automatic code update/upgrade:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh -S
</pre></div>
</div>
<p>To switch on a makina-states branch, like the <strong>v2</strong> branch in production:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./boot-salt.sh -b v2
</pre></div>
</div>
<div class="section" id="upgrade">
<h4>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this headline">¶</a></h4>
<p>Upgrade will:</p>
<blockquote>
<div><ul class="simple">
<li>Run predefined &amp; scheduled upgrade code</li>
<li>Uupdate makina-states repositories in /srv/salt &amp; /srv/makina-states</li>
<li>Update core repositories (like salt code source in /srv/makina-states/src/salt)</li>
<li>Do the highstates (salt and masterone if any)</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">boot</span><span class="o">-</span><span class="n">salt</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">C</span> <span class="o">--</span><span class="n">highstates</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="activating-another-nodetype-preset-after-installation">
<h3>Activating another nodetype preset after installation<a class="headerlink" href="#activating-another-nodetype-preset-after-installation" title="Permalink to this headline">¶</a></h3>
<p>If you installed the <strong>scratch</strong> preset and want to switch to another preset:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>salt-call state.sls makina-states.nodetypes.&lt;your_new_preset&gt;
</pre></div>
</div>
<p>If you installed a preset and want to switch to another preset:</p>
<blockquote>
<div><ul>
<li><p class="first">edit <strong>etc/makina-states/nodetype</strong> and put your new preset</p>
</li>
<li><p class="first">edit <strong>etc/*/makina-states/nodetypes.yaml</strong> and set to false your old
preset</p>
</li>
<li><p class="first">Finally, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>salt-call state.sls makina-states.nodetypes.&lt;your_new_preset&gt;
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 -&gt; 2017, Mathieu Le Marec Pasquet, Régis Leroy &amp; Makina Corpus folks.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>