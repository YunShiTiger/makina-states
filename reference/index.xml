<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Reference on Makina States</title>
    <link>/reference/index.xml</link>
    <description>Recent content in Reference on Makina States</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>fr-FR</language>
    <lastBuildDate>Wed, 15 Mar 2017 23:58:39 +0100</lastBuildDate>
    <atom:link href="/reference/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Preamble</title>
      <link>/reference/preamble/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/preamble/</guid>
      <description>

&lt;h2 id=&#34;briefing&#34;&gt;Briefing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;MakinaStates at a whole is a combination of &lt;a href=&#34;https://www.ansible.com/&#34;&gt;ansible&lt;/a&gt; and &lt;a href=&#34;https://docs.saltstack.com/en/latest/&#34;&gt;salt&lt;/a&gt; aiming at operating a cluster from baremetal to projects
delivery.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Note that makina-states &lt;b&gt;do not use regular salt daemons(minion/master) to operate remotely &lt;br/&gt;
but an ansible bridge that copy the pillar and use salt-call locally
directly on the remote box via SSH&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Ansible get the information from makinastates by getting the salt pillar
for a particular through a custom dynamic inventory.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;compatibility&#34;&gt;Compatibility&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;For now, you will have to use &lt;b&gt;Ubuntu &amp;gt;= 14.04&lt;/b&gt;.&lt;br/&gt;
Makina-States can be ported to any
linux based OS, but we, here, use ubuntu server and this is the only
supported system for now. &lt;br/&gt;
It can be used in any flavor: lxc, docker, baremetal, kvm, etc.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Order of operation</title>
      <link>/reference/sumup/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/sumup/</guid>
      <description>

&lt;h2 id=&#34;organisation-workflow&#34;&gt;Organisation &amp;amp; Workflow&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;makina-states primarely use salt to deploy on the targeted environment.&lt;br&gt;&lt;/li&gt;
&lt;li&gt;Our salt states are thought to be used in a special order,&lt;br/&gt;
and specially when you call salt via the &lt;strong&gt;sls&lt;/strong&gt;: &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/top.sls&#34;&gt;&lt;code&gt;makina-states.top&lt;/code&gt;&lt;/a&gt;.

&lt;ul&gt;
&lt;li&gt;We apply first the &lt;a href=&#34;../nodetype&#34;&gt;nodetype&lt;/a&gt; configuration.&lt;/li&gt;
&lt;li&gt;Then, we will apply the &lt;a href=&#34;../controllers&#34;&gt;controllers&lt;/a&gt; configuration.&lt;br/&gt;&lt;/li&gt;
&lt;li&gt;Then, we will apply &lt;a href=&#34;../localsettings&#34;&gt;localsettings&lt;/a&gt; states&lt;/li&gt;
&lt;li&gt;After all of the previous steps, we may configure &lt;code&gt;services&lt;/code&gt; like
sshd, crond, or databases. If we are on the &lt;strong&gt;scratch&lt;/strong&gt; mode, no
services are configured by default.&lt;/li&gt;
&lt;li&gt;Eventually, we may by able to install projects via &lt;code&gt;mc_project&lt;/code&gt;. &lt;br/&gt;
A project is just a classical code repository which has a &amp;ldquo;.salt&amp;rdquo;
and/or ansible playbooks/roles folder commited with enougth
information on how to deploy it.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;registries&#34;&gt;Registries&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;The configuration of any of the formulas (nodetypes, controllers, localsettings,
services) is handled via Makina-States &lt;a href=&#34;../registries&#34;&gt;registries&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;history&#34;&gt;History&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Makina-States was first using the salt HighState principle of configuring
everything.&lt;/li&gt;
&lt;li&gt;was based at fist on &lt;code&gt;nodetypes presets&lt;/code&gt; that were preselected collections of &lt;a href=&#34;https://docs.saltstack.com/en/latest/topics/tutorials/starting_states.html&#34;&gt;salt states&lt;/a&gt; to apply to the system&lt;br/&gt;&lt;/li&gt;
&lt;li&gt;This is from where the &lt;a href=&#34;https://docs.saltstack.com/en/latest/ref/states/highstate.html&#34;&gt;highstate&lt;/a&gt; will start to run.&lt;/li&gt;
&lt;li&gt;Recently we cutted off this behavior, and now you must apply them explicitly.&lt;br/&gt;
Indeed:

&lt;ul&gt;
&lt;li&gt;highstate tend to grow and when you decide to reapply it you may
accidentaly deliver things you forgotten of.&lt;/li&gt;
&lt;li&gt;It&amp;rsquo;s long, very long to wait to reapply everything for small changes.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Layout</title>
      <link>/reference/layout/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/layout/</guid>
      <description>

&lt;h2 id=&#34;layout&#34;&gt;Layout&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Relative to the top &lt;code&gt;makina-states&lt;/code&gt; clone folder.&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;
 bin/ansible                    -&gt; wrapper to ansible
 bin/ansible-galaxy             -&gt; wrapper to ansible-galaxy
 bin/ansible-playbook           -&gt; wrapper to ansible-playbook
 bin/salt-call                  -&gt; wrapper to salt-call
 ansible/                       -&gt; ansible plays, roles, modules &amp; etc
 etc/                           -&gt; configuration
   etc/ansible/                 -&gt; ansible configuration
   etc/salt/                    -&gt; saltstack configuration
   etc/makina-states/           -&gt; makina-states  configuration
 pillar/                        -&gt; saltstack pillar files
     pillar/pillar.d/           -&gt; saltstack pillar files (global)
     pillar/private.pillar.d/   -&gt; saltstack pillar files
                                  (for the current node)
     pillar/&lt;$minion&gt;.pillar.d/ -&gt; saltstack pillar files
                                  (for a specific minion)
 salt/makina-states/            -&gt; saltstack states
   makina-states/               -&gt; makina-states saltstack states
   salt/_modules/               -&gt; custom salt modules
   salt/_pillar/                -&gt; custom extpillar modules
&lt;/pre&gt;

&lt;h2 id=&#34;salt-pillar&#34;&gt;Salt pillar&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Saltstack configuration is based on pillars.&lt;/li&gt;
&lt;li&gt;To facilitate configuration of the Top file, we added those features:

&lt;ul&gt;
&lt;li&gt;Any &lt;strong&gt;JSON&lt;/strong&gt; file can be used as pillar data.&lt;/li&gt;
&lt;li&gt;Any &lt;strong&gt;SLS/json&lt;/strong&gt; file dropped inside &lt;code&gt;pillar/pillars.d/&lt;/code&gt; will be loaded for all minion as pillar data&lt;/li&gt;
&lt;li&gt;Any &lt;strong&gt;SLS/json&lt;/strong&gt; file dropped inside &lt;code&gt;pillar/private.pillars.d&lt;/code&gt; will be only loaded for the current node of operation.&lt;/li&gt;
&lt;li&gt;Any &lt;strong&gt;SLS/json&lt;/strong&gt; file dropped inside &lt;code&gt;pillar/&amp;lt;$minionid&amp;gt;.pillars.d&lt;/code&gt; will be only loaded for the &amp;ldquo;\$minionid&amp;rdquo; host&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;salt-ansible-bridge-notes&#34;&gt;Salt + Ansible bridge notes&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Makina-states has better to use an &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/ansible/inventories/makinastates.py&#34;&gt;ansible dynamic inventory&lt;/a&gt;
that bridges the salt pillar with ansible via a salt module:
&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_remote_pillar.py&#34;&gt;mc_remote_plllar&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;This module is pluggable and will search in the salt modules installed
those who have declared special named functions:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;get_masterless_makinastates_hosts()&lt;/code&gt;&lt;/p&gt;

&lt;dl&gt;
&lt;dd&gt;return a list of host to manage&lt;/dd&gt;
&lt;dt&gt;&lt;code&gt;get_masterless_makinastates_groups(minionid, pillar)&lt;/code&gt;&lt;/dt&gt;
&lt;dd&gt;return a list of groups for the specific minion id&lt;/dd&gt;
&lt;/dl&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;For each host found by all &lt;code&gt;get_masterless_makinastates_hosts&lt;/code&gt; functions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Get its pillar by calling
&lt;code&gt;mc_remote_pillar.get_pillar($host)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Extract/generate from informations in the pillar relevant ansible
host vars for this minion. &lt;strong&gt;saltpillar&lt;/strong&gt; ansible hostvar is the
pillar of this minion.&lt;/li&gt;
&lt;li&gt;Generate ansible groups from those hostvars by calling eac
&lt;code&gt;get_masterless_makinastates_groups&lt;/code&gt; function&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;By default, we use the &lt;code&gt;mc_pillar&lt;/code&gt; ext pillar which loads a file:
&lt;code&gt;etc/makina-states/database.sls&lt;/code&gt; which describe our infractructure and
this will:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;list all nodes that are configured as ansible targets&lt;/li&gt;
&lt;li&gt;generate pillar info for all nodes (and per se fall inside
the ansible inventory of those related hosts.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;custom-extpillar&#34;&gt;Custom extpillar&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;In other words, to add your custom way of managing your hosts:

&lt;ul&gt;
&lt;li&gt;Create an ext_pillar to complete the pillar for a specific minion
depending on its &lt;code&gt;minion id&lt;/code&gt; and that&amp;rsquo;s why the easiest way
is to adopt a minionid/hostname naming scheme.&lt;/li&gt;
&lt;li&gt;Create a module that implement the &lt;code&gt;get_masterless_makinastates_hosts&lt;/code&gt; &amp;amp;&amp;amp; &lt;code&gt;get_masterless_makinastates_groups&lt;/code&gt; functions&lt;/li&gt;
&lt;li&gt;register the pillar and module to the local makina-states installation (see bellow)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Take example on:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_pillar.py&#34;&gt;module&lt;/a&gt; : (search for &lt;code&gt;get_masterless_makinastates_groups&lt;/code&gt; &amp;amp;&amp;amp; &lt;code&gt;get_masterless_makinastates_hosts&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/pillar/mc_pillar.py&#34;&gt;extpillar&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To load your extpillar, you ll have to add it to the local salt configuration. &lt;br/&gt;
You can add a file this way&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;$WC/etc/salt/minion.d/99_extpillar.conf&lt;/span&gt; 
    &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;ext_pillar&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;mc_pillar&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p p-Indicator&#34;&gt;{}&lt;/span&gt;
        &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;mc_pillar_jsons&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p p-Indicator&#34;&gt;{}&lt;/span&gt;
        &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;mycustompillar&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p p-Indicator&#34;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To load your custom module, place it under &lt;code&gt;$WC/salt/_modules&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To load your custom pillar, place it under &lt;code&gt;$WC/salt/_pillar&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;verify-the-pillar-for-a-minion&#34;&gt;Verify the pillar for a minion&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Use this command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call mc_remote_pillar.get_pillar &amp;lt;minion_id&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;verify-the-groups-for-a-minion&#34;&gt;Verify the groups for a minion&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Use this command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call mc_remote_pillar.get_groups &amp;lt;minion_id&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;optional-add-a-cron-to-speed-up-pillar-generation&#34;&gt;(OPTIONAL) Add a cron to speed up pillar generation&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;To generate regularly the cron for all the configured minion, to speed
up regular ansible calls (the pillar will already be cached at the call
time), you can register a cron that does that.&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;/etc/cron.d/refresh_ansible&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;
15,30,45,00 * * * * root /srv/makina-states/_scripts/refresh_makinastates_pillar.sh
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>database.sls</title>
      <link>/reference/databasesls/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/databasesls/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;For configuring a single machine, you can rely on a local crafted pillar,
but to operate on a cluster, it would be a lot more cumbersome and not &lt;strong&gt;DRY&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Fir this we created &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_pillar.py&#34;&gt;&lt;code&gt;mc_pillar&lt;/code&gt;&lt;/a&gt;, an ext_pillar that describe a whole
cluster infrastructure from a single &lt;strong&gt;SLS&lt;/strong&gt; file.&lt;/li&gt;
&lt;li&gt;This special file, &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/etc/makina-states/database.sls.in&#34;&gt;&lt;code&gt;etc/makina-states/database.sls&lt;/code&gt;&lt;/a&gt;. will
describe our infrastructure and specially how to access to the remote
systems.&lt;/li&gt;

&lt;li&gt;&lt;p&gt;At first, you will need to copy &lt;code&gt;etc/makina-states/database.sls.in&lt;/code&gt; which is a sample, and adapt it to your needs:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;cp etc/makina-states/database.sls.in &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
      etc/makina-states/database.sls
&lt;span class=&#34;nv&#34;&gt;$EDITOR&lt;/span&gt; etc/makina-states/database.sls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;The contents of the file is mostly self explainatory.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;This file is then parsed by the &lt;strong&gt;mc_pillar module&lt;/strong&gt; (called via an
extpillar hook) to get the appropriate pillar for a specific minion id.
This pillar aims to grab a good part of its system configuration from backups to
ssl, to cloud configuration and so on.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;We heavyly rely on memcached to improve the performance, so first please
install it this way:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call -lall state.sls makina-states.services.cache.memcached
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;verify-the-pillar-for-a-minion-after-a-database-sls-change&#34;&gt;Verify the pillar for a minion after a database.sls change&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Use this command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;service memcached restart
bin/salt-call mc_pillar.ext_pillar &amp;lt;minion_id&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Registries &amp; Configuration</title>
      <link>/reference/registries/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/registries/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;We needed a way, in our &lt;strong&gt;salt&lt;/strong&gt; states:

&lt;ul&gt;
&lt;li&gt;To deduplicate the cumbersome handling of variables&lt;/li&gt;
&lt;li&gt;To make cleaner jinja code&lt;/li&gt;
&lt;li&gt;For a configuration knob, aggregate values from difference sources, by precedence.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;For this, we decided to abstract this in python code&lt;/li&gt;

&lt;li&gt;&lt;p&gt;So, a &lt;strong&gt;registry&lt;/strong&gt; in the Makina-States vocabulary is a
&lt;a href=&#34;https://docs.saltstack.com/en/latest/ref/modules/&#34;&gt;salt execution module&lt;/a&gt; that returns a python dictionnary:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;containing various configuration knobs&lt;/li&gt;
&lt;li&gt;with &lt;strong&gt;sane defaults&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;overridable at will by the user via the &lt;strong&gt;pillar&lt;/strong&gt; or the &lt;strong&gt;grains&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The idea was then to use dedicated saltstack execution modules to provide
a way to have dictionnaries of data aggregated with this precedence:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Pillar (&lt;strong&gt;&lt;strong&gt;pillar&lt;/strong&gt;&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Grains (&lt;strong&gt;&lt;strong&gt;grains&lt;/strong&gt;&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Configuration of the minion (&lt;strong&gt;&lt;strong&gt;opts&lt;/strong&gt;&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Configuration of the minion (&lt;strong&gt;&lt;strong&gt;opts&lt;/strong&gt;[&amp;lsquo;master]&amp;rsquo;]&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Exemples:

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_apache.py&#34;&gt;mc_apache&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_nginx.py&#34;&gt;mc_nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_mysql.py&#34;&gt;mc_mysql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Those registries rely on an heavily used function &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_utils.py#L681&#34;&gt;&lt;code&gt;mc_utils.default&lt;/code&gt;&lt;/a&gt; that will do the job of gathering for the &lt;code&gt;configuration prefix&lt;/code&gt; all the knobs
from the various pieces of data we want (pillar, grains, opts)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Thus, by example, you want to install the mysql service:&lt;br&gt;
You will use this sls:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;  bin/salt-call -linfo --retcode-passthrough &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
    state.sls makina-states.servies.db.mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Reading the code of &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/db/mysql/configuration.sls#L11&#34;&gt;mysql formula&lt;/a&gt;, you see that it calls &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_mysql.py#L157&#34;&gt;mc_mysql&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;To override the &lt;code&gt;port&lt;/code&gt; (default: 3306), you can do this in the pillar
or the grains those ways&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Flat Method(preferred): &lt;strong&gt;pillar/pillar.d/mysql.sls&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;makina-states.services.db.mysql.port&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;3306&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;Nested Method: &lt;strong&gt;pillar/pillar.d/mysql.sls&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;makina-states.services.db.mysql&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;3306&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Nodetypes</title>
      <link>/reference/nodetypes/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/nodetypes/</guid>
      <description>

&lt;h3 id=&#34;nodetypes&#34;&gt;Nodetypes&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Your choice for &lt;code&gt;nodetype&lt;/code&gt; is one of:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;scratch (default)&lt;/strong&gt;
 :   only manage the ansible/salt installation and configuration.&lt;br/&gt;
     You ll want to activate this mode if you want
     to apply explicitly your states without relying of default
     nodetypes configuration.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;server&lt;/strong&gt;
 :   matches a baremetal server, and manage it
     from end to end (base packages, network, locales, sshd, crond,
     logrotate, etc, by default)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;vm&lt;/strong&gt;
 :   VM (not baremetal), this is mostly like &lt;strong&gt;server&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;lxccontainer&lt;/strong&gt;
 :   matches a lxc container mostly like &lt;strong&gt;server&lt;/strong&gt;
     but install and fix lxc boot scripts&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;laptop&lt;/strong&gt;
 :   mostly like &lt;strong&gt;server&lt;/strong&gt; but also install packages for
     working on a developement machine (prebacking a laptop for
     a dev&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;dockercontainer&lt;/strong&gt;
 :   matches a VM (not baremetal), this is
     mostly like &lt;strong&gt;server&lt;/strong&gt;, but install &amp;amp; preconfigure circus to
     manage daemons.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;devhost&lt;/strong&gt;
 :   development machine enabling
     states to act on that, by example installation of a test
     local-loop mailer.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;vagrantvm&lt;/strong&gt;
 :    flag vagrant boxes and is a subtype of devhost&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You can tell &lt;a href=&#34;/usage/&#34;&gt;&lt;code&gt;boot-salt2.sh&lt;/code&gt;&lt;/a&gt; which nodetype to use via the &lt;code&gt;--nodetype&lt;/code&gt; switch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;boot-salt2.sh --nodetype server --reconfigure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;switching-to-another-nodetype-on-an-already-installed-environment&#34;&gt;Switching to another nodetype on an already installed environment&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;If you installed the &lt;strong&gt;scratch&lt;/strong&gt; preset and want to switch to another preset:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call state.sls makina-states.nodetypes.&amp;lt;your_new_preset&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;If you installed a preset and want to switch to another preset:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;edit &lt;code&gt;etc/makina-states/nodetype&lt;/code&gt; and put your new preset&lt;/li&gt;
&lt;li&gt;edit &lt;code&gt;etc/makina-states/nodetypes.yaml&lt;/code&gt; and set to false your old preset&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Ask bootsalt to remember&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;boot-salt2.sh --nodetype &amp;lt;your_new_preset&amp;gt; --reconfigure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Finally, run:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call state.sls makina-states.nodetypes.&amp;lt;your_new_preset&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Usage</title>
      <link>/reference/projects/usage/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/projects/usage/</guid>
      <description>

&lt;h2 id=&#34;specification&#34;&gt;Specification&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;A project in &lt;strong&gt;corpus / makina-states&lt;/strong&gt; is a &lt;strong&gt;git repository&lt;/strong&gt; checkout
which contains the code and &lt;br/&gt;
a well known saltstack based procedure
to deploy it from end to end in the &lt;strong&gt;.salt&lt;/strong&gt; folder.&lt;/li&gt;
&lt;li&gt;Bear in mind the &lt;a href=&#34;/reference/projects/usage/#structure&#34;&gt;project layout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;You may have a look to the (now outdatedà original &lt;a href=&#34;/reference/projects/RFC/&#34;&gt;project_corpus&lt;/a&gt; specification&lt;/li&gt;
&lt;li&gt;A good sumup of the spec is as follow:

&lt;ul&gt;
&lt;li&gt;There is a separate repo distributed along the project named
&lt;strong&gt;pillar&lt;/strong&gt; to store configuration variables, passwords and so on.&lt;/li&gt;
&lt;li&gt;Projects are deployed via instructions based on saltstack which
are contained into the &lt;strong&gt;.salt&lt;/strong&gt; folder along the codebase.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Projects can be deployed in two modes:

&lt;ul&gt;
&lt;li&gt;via a git push on a local, separated git repository where some hooks are wired to launch the deployment&lt;/li&gt;
&lt;li&gt;If no remotes, deploy the code source we have locally&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;The deployment folder, &lt;code&gt;.salt&lt;/code&gt;, that you will provide along your codebase will describe how to deploy your project.

&lt;ul&gt;
&lt;li&gt;Deployment consist in &lt;code&gt;META&lt;/code&gt; deployment phases:

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;archive&lt;/strong&gt; &lt;code&gt;.salt/archive.sls&lt;/code&gt;: synchronnise the project to the &lt;code&gt;archive&lt;/code&gt; folder before deploying&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sync code&lt;/strong&gt; from remotes if there are remotes: if any remotes, synchronise both the pillar and the project
git folder to their corresponding checkouted working copies&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sync/install custom salt modules&lt;/strong&gt; (exec, states, etc) from the codebase if any from the &lt;code&gt;.salt&lt;/code&gt; folder&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;fixperms&lt;/strong&gt; (&lt;code&gt;.salt/fixperms.sls&lt;/code&gt;): enforce filesystem permissions&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;install&lt;/strong&gt; (&lt;code&gt;.salt/install.sls&lt;/code&gt;): Run project deployment procedure

&lt;ul&gt;
&lt;li&gt;Run any &lt;code&gt;sls&lt;/code&gt; in the &lt;code&gt;.salt&lt;/code&gt; folder (alphanum sorted) which:

&lt;ul&gt;
&lt;li&gt;Is not a main procedure sls&lt;/li&gt;
&lt;li&gt;Is not a task (beginning with &lt;code&gt;task&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;the convention is to name them &lt;code&gt;\d\d\d_NAME.sls&lt;/code&gt;  (&lt;code&gt;000_prereqs.sls&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;fixperms&lt;/strong&gt; (&lt;code&gt;.salt/fixperms.sls&lt;/code&gt;): enforce filesystem permissions&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rollback&lt;/strong&gt; (&lt;code&gt;.salt/rollback.sls&lt;/code&gt;): if error, rollback procedure (by default sync from &lt;code&gt;archived&lt;/code&gt; folder&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;notify&lt;/strong&gt; OPTIONNAL/LEGACY (&lt;code&gt;.salt/notify.sls&lt;/code&gt;): after deployment, notify commands&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;All other sls found at &lt;strong&gt;toplevel&lt;/strong&gt; of the &lt;code&gt;.salt&lt;/code&gt; folder  which are not those ones are
executed in lexicographical order (alphanum) and&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;.salt/PILLAR.sample&lt;/code&gt; file contains default configuration variable for
your project and helps you to know what variable to override in your
custom pillar.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;structure&#34;&gt;Structure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;This empty structure respects the aforementioned corpus reactor
layout, and is just an useless helloword project which should look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;srv&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;projects&lt;span class=&#34;o&#34;&gt;/&amp;lt;&lt;/span&gt;project_name&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; pillar&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;init.sls&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; override values &lt;span class=&#34;kr&#34;&gt;in&lt;/span&gt; PILLAR.sample and define
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                   any other arbitrary pillar DATA.
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;/:&lt;/span&gt; anything which is persisted to disk must live here
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;         from drupal sites&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;default&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;files&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; python eggs&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; buildouts parts&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;         gems cache&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; sqlite files&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; static files&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; docroots&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; etc.
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; project&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; a checkout or your project
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;.&lt;/span&gt;git
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt;  codebase
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;.&lt;/span&gt;salt
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; _modules &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; custom salt python exec modules
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; _states  &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; custom salt python states modules
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; _runners &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; custom salt python runners modules
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; _&lt;span class=&#34;kc&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; PILLAR.sample
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; task_foo.sls
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;_deploy.sls
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; If &lt;span class=&#34;s&#34;&gt;&amp;quot;remote_less&amp;quot;&lt;/span&gt; is False &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;default&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; git&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;project.git&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; bare git repos synchronnized &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;bi&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;directional&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                   with project&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; used by git push style deployment
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; git&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;pillar.git&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;  bare git repos synchronnized &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;bi&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;directional&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                   with pillar&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; used by git push style deployment
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; arhives&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; past deployment archive folders
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;U&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;U&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;D1&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;U&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;U&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;D2&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;What you want to do is to replace the &lt;code&gt;project&lt;/code&gt; folder by your repo.&lt;br/&gt;
This one contains your code, as asual, plus the &lt;strong&gt;.salt&lt;/strong&gt; folder.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;WELL Understand&lt;/strong&gt; what is :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;a &lt;a href=&#34;http://docs.saltstack.com/en/latest/topics/tutorials/starting_states.html#moving-beyond-a-single-sls&#34;&gt;salt SLS&lt;/a&gt;, it is the nerve of the war.&lt;/li&gt;
&lt;li&gt;the &lt;a href=&#34;http://docs.saltstack.com/en/latest/topics/tutorials/pillar.html&#34;&gt;Pillar of salt&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;be ware&lt;/strong&gt;, on the production server the &lt;code&gt;.git/config&lt;/code&gt; is linked
with the makina-states machinery, &lt;strong&gt;NEVER MESS WITH ORIGIN AND MASTER BRANCH&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Ensure to to have at least in your project git folder:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.salt/PILLAR.sample&lt;/code&gt;: configuration default values to use in
SLSes&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.salt/archive.sls&lt;/code&gt;: archive step&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.salt/fixperms.sls&lt;/code&gt;: fixperm step&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.salt/rollback.sls&lt;/code&gt;: rollback step&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You can then add as many SLSes as you want, and the ones directly in
&lt;strong&gt;.salt&lt;/strong&gt; will be executed in alphabetical order except the ones
beginning with &lt;strong&gt;task_&lt;/strong&gt; (task_foo.sls). Indeed the ones beginning
with &lt;strong&gt;task_&lt;/strong&gt; are different beasts and are intended to be either
included by your other slses to factor code out or to be executed
manually via the &lt;code&gt;mc_project.run_task&lt;/code&gt; command.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You can and must have a look for inspiration on &lt;a href=&#34;/reference/templates/&#34;&gt;project templates&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;deployment-workflows&#34;&gt;Deployment workflows&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;To build and deploy your project we provide two styles of doing style
that should be appropriate for most use cases.

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/reference/projects/usage/#the-local-build-workflow&#34;&gt;A local build workflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/projects/usage/#the-git-push-to-prod-deploy-workflow&#34;&gt;A distant git-push style workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;the-local-build-workflow&#34;&gt;The local build workflow&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;INITIALLY:

&lt;ul&gt;
&lt;li&gt;use &lt;code&gt;mc_project.init_project&lt;/code&gt; to create the structure to host your project&lt;/li&gt;
&lt;li&gt;use &lt;code&gt;mc_project.report&lt;/code&gt; to verify things are in place&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Then

&lt;ul&gt;
&lt;li&gt;Edit/Place code in the pillar  folder: &lt;code&gt;/srv/projects/&amp;lt;project&amp;gt;/pillar&lt;/code&gt; to configure the project&lt;/li&gt;
&lt;li&gt;Edit/Place code in the project folder: &lt;code&gt;/srv/projects/&amp;lt;project&amp;gt;/project&lt;/code&gt; and manually launch the deploy&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Wash, Rince, Repeat&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;the-git-push-to-prod-deploy-workflow&#34;&gt;The git push to prod deploy workflow&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;INITIALLY:

&lt;ul&gt;
&lt;li&gt;use &lt;code&gt;mc_project.init_project&lt;/code&gt; to create the structure to host your project&lt;/li&gt;
&lt;li&gt;use &lt;code&gt;mc_project.report&lt;/code&gt; to verify things are in place&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Then

&lt;ul&gt;
&lt;li&gt;git push/or edit then push the pillar &lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/git/pillar.git&lt;/code&gt; to configure the project&lt;/li&gt;
&lt;li&gt;git push/or edit then push the code inside &lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/git/project.git&lt;/code&gt; which triggers the deploy&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Wash, Rince, Repeat&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;deployment-stategy&#34;&gt;Deployment stategy&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;To sum all that up, when beginning a project you will:

&lt;ul&gt;
&lt;li&gt;Initialize if not done a project structure with&lt;br/&gt;
&lt;code&gt;salt-call mc_project.init_project project&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;If you do not want git remotes, you can alternativly use&lt;br/&gt;
&lt;code&gt;salt-call mc_project.init_project project remote_less=true&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;add a &lt;strong&gt;.salt&lt;/strong&gt; folder alongside your project codebase (in it&amp;rsquo;s
git repo).&lt;/li&gt;
&lt;li&gt;deploy it, either by:

&lt;ul&gt;
&lt;li&gt;In &lt;strong&gt;remote_less=True&lt;/strong&gt; mode or connected to the remote host to deploy onto:

&lt;ul&gt;
&lt;li&gt;edit/commit/push in &lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/pillar&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;edit/commit/push/push to force in &lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/project&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Launch the &lt;code&gt;salt-call mc_project.deploy &amp;lt;project&amp;gt; only=install,fixperms,sync_modules&lt;/code&gt; dance&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;In &lt;strong&gt;remote_less=False&lt;/strong&gt; mode:

&lt;ul&gt;
&lt;li&gt;git push your &lt;strong&gt;pillar&lt;/strong&gt; files to&lt;br/&gt;
&lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/git/pillar.git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;git push your &lt;strong&gt;project code&lt;/strong&gt; to&lt;br/&gt;
&lt;code&gt;host:/srv/projects/&amp;lt;project&amp;gt;/git/project.git&lt;/code&gt;&lt;br/&gt;
(this last push triggers a deploy on the remote server)&lt;/li&gt;
&lt;li&gt;Your can use &lt;code&gt;--force&lt;/code&gt; as the deploy system only await the
&lt;code&gt;.salt&lt;/code&gt; folder. As long as the folder is present of the
working copy you are sending, the deploy system will be happy.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Wash, Rince, Repeat&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;initialize-the-project-layout&#34;&gt;Initialize the project layout&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The first thing to do when deploying a project is to create a &lt;strong&gt;nest&lt;/strong&gt; from it:&lt;br/&gt;
&lt;strong&gt;IF IT IS NOT ALREADY DONE&lt;/strong&gt; (just &lt;code&gt;ls /srv/projects&lt;/code&gt; to check):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call --local --retcode-passthrough -lall mc_project.init_project &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
    &amp;lt;project_name&amp;gt; &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;remote_less&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;false/true&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;Dont be long, and dont use &lt;code&gt;-&lt;/code&gt; &amp;amp; &lt;code&gt;_&lt;/code&gt; for the &lt;code&gt;project name&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;(opt) &lt;code&gt;remote_less&lt;/code&gt; instructs to deploy with or without the git
repos that allow users to use (or not) a &lt;strong&gt;git push to prod to deploy&lt;/strong&gt; workflow.

&lt;ul&gt;
&lt;li&gt;If &lt;code&gt;remote_less=true&lt;/code&gt;, the git repos wont be created, and you
will have to use only the the &lt;code&gt;local build workflow&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;If &lt;code&gt;remote_less=false&lt;/code&gt;, you can use both the &lt;code&gt;local build workflow&lt;/code&gt;
and the &lt;code&gt;git push to prod deploy workflow&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--local -lall&lt;/code&gt; instructs to run in masterless mode and extra verbosity&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mc_project.init_project $project&lt;/code&gt; instructs to create the layout of
the name &lt;code&gt;$project&lt;/code&gt; project living into &lt;code&gt;/srv/projects/$project/project&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;running-deployment-procedure&#34;&gt;Running deployment procedure&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The following command is the nerve of the war:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;bin/salt-call --local --retcode-passthrough -lall &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
     mc_project.deploy &lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;only&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;step2&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;,step1&lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;only_steps&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;step2&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;,step1&lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;mc_project.deploy $project&lt;/code&gt; instructs to deploy the name &lt;code&gt;$project&lt;/code&gt;
project living into &lt;code&gt;/srv/projects/$project/project&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;(opt) &lt;code&gt;only&lt;/code&gt; instructs to execute only the named global phases, and
when deploying directly onto a machine, you will certainly have to
use &lt;code&gt;only=install,fixperms,sync_modules&lt;/code&gt; to avoid the
archive/sync/rollback steps.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;(opt) &lt;code&gt;only_steps&lt;/code&gt; instruct to execute only a specific or multiple
specific sls from the &lt;strong&gt;.salt&lt;/strong&gt; folder during the &lt;strong&gt;install&lt;/strong&gt; phase.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;tutorial&#34;&gt;Tutorial&lt;/h2&gt;

&lt;h3 id=&#34;projects-reminder-tool&#34;&gt;Projects reminder tool&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WARNING&lt;/strong&gt;: you can use it only if you provisionned your project
with attached remotes (the default)&lt;/li&gt;
&lt;li&gt;Remember use the remotes inside &lt;code&gt;/srv/projects/&amp;lt;project&amp;gt;/git&lt;/code&gt; and
not directly the working copies&lt;/li&gt;
&lt;li&gt;If you push on the pillar, it does not trigger a deploy&lt;/li&gt;
&lt;li&gt;If you push on the project, it triggers the full deploy procedure
including archive/sync/rollback.&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To get useful push informations, on the remote server to deploy to,
just do&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;salt-call -lall mc_project.report
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;using-local-build-workflow&#34;&gt;Using local build workflow&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/install&#34;&gt;install makinastates&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Initialise the layout (only the first time)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;ssh root@remoteserver
&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;
salt-call mc_project.init_project &lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;remote_less&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Edit the pillar&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /srv/projects/&lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt;/pillar
&lt;span class=&#34;nv&#34;&gt;$EDITOR&lt;/span&gt; init.sls
git commit -am up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Add your project code&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /srv/projects/&lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt;/project
&lt;span class=&#34;c1&#34;&gt;# if not already done, add your project repo remote&lt;/span&gt;
git remote add o https://github.com/o/myproject.git
&lt;span class=&#34;c1&#34;&gt;# in any cases, update your code&lt;/span&gt;
git fetch --all
git reset --hard remotes/o/&amp;lt;the branch to deploy&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Run the deployment procedure, &lt;strong&gt;skipping archive/rollback&lt;/strong&gt; as you are connected and live editing&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;salt-call mc_project.deploy &lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;only&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;install,fixperms,sync_modules
&lt;span class=&#34;c1&#34;&gt;# or to deploy only a specific sls&lt;/span&gt;
salt-call &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
    mc_project.deploy &lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;only&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;install,fixperms,sync_modules &lt;span class=&#34;nv&#34;&gt;only_steps&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;000_foo.sls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;When you want to commit your changes&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; vms/VM/srv/&lt;span class=&#34;nv&#34;&gt;$project&lt;/span&gt;/project
git push o HEAD:&amp;lt;master&amp;gt; &lt;span class=&#34;c1&#34;&gt;# replace master by the branch you want to push&lt;/span&gt;
                         &lt;span class=&#34;c1&#34;&gt;# back onto your forge&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;using-git-push-to-prod-deploy-workflow&#34;&gt;Using git push to prod deploy workflow&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/install&#34;&gt;install makinastates&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The following lines edit the pillar, and push it, this does not trigger a deploy&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$WORKSPACE&lt;/span&gt;/myproject
git clone host:/srv/projects/project/git/pillar.git
&lt;span class=&#34;nv&#34;&gt;$EDITOR&lt;/span&gt; pillar/init.sls
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; pillar&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;git commit -am up&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;git push&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The following lines prepare a clone of your project codebase to be able
to be deployed onto production or staging servers&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$WORKSPACE&lt;/span&gt;/myproject
git clone git@github.com/makinacorpus/myawsomeproject.git
git remote add prod /srv/projects/project/git/project.git
git fetch --all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To trigger a remote deployment, now you can do:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;git push &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;--force&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; prod &amp;lt;mybranch&amp;gt;:master
eg: git push &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;--force&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; prod &amp;lt;mybranch&amp;gt;:master
eg: git push &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;--force&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; prod awsome_feature:master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;REMINDER&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;DONT MESS WITH THE &lt;strong&gt;ORIGIN&lt;/strong&gt; REMOTE when your are connected
to your server in any of the &lt;code&gt;pillar&lt;/code&gt; or
&lt;code&gt;project&lt;/code&gt; directory..&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;&amp;lt;branchname&amp;gt;:master&lt;/code&gt; is really important as everything
in the production git repositories is wired on the &lt;code&gt;master&lt;/code&gt;
branch. You can push any branch you want from your original
repository, but in production, there is only &lt;strong&gt;master&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;configuration-pillar-variables&#34;&gt;Configuration pillar &amp;amp; variables&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;We provide in &lt;strong&gt;mc_project&lt;/strong&gt; a powerfull mecanism to define configuration
variables used in your deployments that you can safely override in the
salt pillar files.&lt;br/&gt;
This means that you can set some default values for,
eg a domain name or a password, and input the production values that you
won&amp;rsquo;t commit along side your project codebase.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Default values have to be stored inside the &lt;strong&gt;PILLAR.sample&lt;/strong&gt; file.&lt;/li&gt;
&lt;li&gt;Some of those variables, the one at the first level are mostly read
only and setup by makina-states itself.&lt;br/&gt;
The most important are:

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt;: project name&lt;/li&gt;
&lt;li&gt;&lt;code&gt;user&lt;/code&gt;: the system user of your project&lt;/li&gt;
&lt;li&gt;&lt;code&gt;group&lt;/code&gt;: the system group of your project&lt;/li&gt;
&lt;li&gt;&lt;code&gt;data&lt;/code&gt;: top level free variables mapping&lt;/li&gt;
&lt;li&gt;&lt;code&gt;project_root&lt;/code&gt;: project root absolute path&lt;/li&gt;
&lt;li&gt;&lt;code&gt;data_root&lt;/code&gt;: persistent folder absolute path&lt;/li&gt;
&lt;li&gt;&lt;code&gt;default_env&lt;/code&gt;: environment (staging/prod/dev)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pillar_root&lt;/code&gt;: absolute path to the pillar&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fqdn&lt;/code&gt;: machine FQDN&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;The only variables that you can edit at the first level are:

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;remote_less&lt;/strong&gt;: is this project using git remotes for triggering deployments&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;default_env&lt;/strong&gt;: environement (valid values are staging/dev/prod)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;The other variables, members of the &lt;strong&gt;data&lt;/strong&gt; sub entry are free for you to add/edit.&lt;/li&gt;
&lt;li&gt;Anything defined in the pillar &lt;code&gt;pillar/init.sls&lt;/code&gt; overloads what is in &lt;code&gt;project/.salt/PILLAR.sample&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You can get and consult the result of the configuration assemblage like
this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;  bin/salt-call --retcode-passthrough mc_project.get_configuration &amp;lt;project_name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Remember that projects have a name, and the pillar key to configure
and overload your project configuration is based on this key.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;EG: If your project is name &lt;strong&gt;foo&lt;/strong&gt;, you ll have to use
&lt;strong&gt;makina-projects.foo&lt;/strong&gt; in place of &lt;strong&gt;makina-projects.example&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;example&#34;&gt;Example:&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;in &lt;code&gt;project/.salt/PILLAR.sample&lt;/code&gt;, you have:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;makina-projects.projectname&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;start_cmd&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#39;myprog&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;in &lt;code&gt;pillar/init.sls&lt;/code&gt;, you have:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;makina-projects.foo&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
   &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
     &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;start_cmd&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#39;myprog2&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;In your states files, you can access the configuration via the magic &lt;code&gt;opts.ms_project&lt;/code&gt; variable.&lt;/li&gt;
&lt;li&gt;In your modules or file templates, you can access the configuration via &lt;code&gt;salt[&#39;mc_project.get_configuration&#39;(name)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;A tip for loading the configuration from a template is doing something like that:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# project/.salt/00_deploy.sls&lt;/span&gt;
&lt;span class=&#34;p p-Indicator&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;set cfg = opts.ms_project %&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;toto&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;file.managed&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;quot;source://makina-projects/{{cfg.name}}/files/etc/foo&amp;quot;&lt;/span&gt;
      &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;/etc/foo&lt;/span&gt;
      &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;user {{cfg.user}}&lt;/span&gt;
      &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;group {{cfg.user}}&lt;/span&gt;
      &lt;span class=&#34;p p-Indicator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;defaults&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt;
          &lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p p-Indicator&#34;&gt;{{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cfg.name&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;}}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# project/.salt/files/etc/foo&lt;/span&gt;
&lt;span class=&#34;p p-Indicator&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;set cfg = opts.ms_project %&lt;/span&gt;&lt;span class=&#34;p p-Indicator&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;l l-Scalar l-Scalar-Plain&#34;&gt;My Super Template of {{cfg.name}} will run {{cfg.data.start_cmd}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;saltstack-integration&#34;&gt;SaltStack integration&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;As you know makina-states embeds its own virtualenv and salt codebase.&lt;br/&gt;
In makina-states, we use by default:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;makina states itself: &lt;code&gt;/srv/makina-states&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;a virtualenv inside &lt;code&gt;/srv/makina-states/venv&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makina-corpus/salt.git&#34;&gt;salt from a fork&lt;/a&gt; installed inside &lt;code&gt;$makinastates/venv/src/salt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;As you see, the project layout seems not integration on those following
folders, but in fact, the project initialisation routines made symlinks
to integrate it which look like:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$makinastates/salt/makina-projects/&amp;lt;project_name&amp;gt;&amp;gt;&lt;/code&gt; -&amp;gt; &lt;code&gt;/srv/projects/&amp;lt;project_name&amp;gt;/project§/.salt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$makinastates/pillar/pillar.d/makina-projects/&amp;lt;project_name&amp;gt;&lt;/code&gt; -&amp;gt; &lt;code&gt;/srv/projects/&amp;lt;project_name&amp;gt;/pillar&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The pillar is auto included in the &lt;strong&gt;pillar top&lt;/strong&gt; (&lt;code&gt;/srv/pîllar/top.sls&lt;/code&gt;).&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The project salt files are not and &lt;strong&gt;must not&lt;/strong&gt; be included in the
salt &lt;strong&gt;top&lt;/strong&gt; for further highstates unless you know what you are doing.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You can unlink your project from salt with:&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;   bin/salt-call --retcode-passthrough mc_project.unlink &amp;lt;project_name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;You can link project from salt with:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span&gt;&lt;/span&gt;   bin/salt-call --retcode-passthrough mc_project.link &amp;lt;project_name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Controllers</title>
      <link>/reference/controllers/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/controllers/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;controllers states purpose is mainly to check:

&lt;ul&gt;
&lt;li&gt;our bundled salt &amp;amp; ansible binaries are ready for operation&lt;/li&gt;
&lt;li&gt;the cloned code is up to date and clean&lt;/li&gt;
&lt;li&gt;If the user selected them:

&lt;ul&gt;
&lt;li&gt;crons are in place&lt;/li&gt;
&lt;li&gt;install links (&lt;code&gt;/usr/local/bin&lt;/code&gt;) are present&lt;/li&gt;
&lt;li&gt;RollingRealse updater crons are in place&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>LocalSettings</title>
      <link>/reference/localsettings/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/localsettings/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;LocalSettings states are related to the low level configuration of an environment&lt;br/&gt;
EG:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;locales&lt;/li&gt;
&lt;li&gt;network&lt;/li&gt;
&lt;li&gt;low level configuration](hardrive, etc)&lt;/li&gt;
&lt;li&gt;installing compilers &amp;amp; language interpreters&lt;/li&gt;
&lt;li&gt;configuring base tools &amp;amp; editors&lt;/li&gt;
&lt;li&gt;configuring SSH client&lt;/li&gt;
&lt;li&gt;distributing SSL certificates&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;If any other preset than &lt;code&gt;scratch&lt;/code&gt; has been activated, &lt;br/&gt;
Many localsettings will be applied by default, see &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/mc_states/modules/mc_localsettings.py#L113&#34;&gt;mc_localsettings:registry&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;states&#34;&gt;States&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings&#34;&gt;localsettings States&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;non exhaustive shortcuts:&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/apparmor&#34;&gt;localsettings/apparmor&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/nodejs&#34;&gt;localsettings/nodejs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/hostname&#34;&gt;localsettings/hostname&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/sudo&#34;&gt;localsettings/sudo&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/autoupgrade&#34;&gt;localsettings/autoupgrade&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/npm&#34;&gt;localsettings/npm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/hosts&#34;&gt;localsettings/hosts&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/sysctl&#34;&gt;localsettings/sysctl&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/casperjs&#34;&gt;localsettings/casperjs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/nscd&#34;&gt;localsettings/nscd&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/init.sls&#34;&gt;localsettings/init.sls&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/systemd&#34;&gt;localsettings/systemd&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/check_raid&#34;&gt;localsettings/check_raid&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/phantomjs&#34;&gt;localsettings/phantomjs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/insserv&#34;&gt;localsettings/insserv&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/timezone&#34;&gt;localsettings/timezone&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/desktoptools&#34;&gt;localsettings/desktoptools&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/pkgs&#34;&gt;localsettings/pkgs&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/jdk&#34;&gt;localsettings/jdk&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/updatedb&#34;&gt;localsettings/updatedb&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/dns&#34;&gt;localsettings/dns&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/python&#34;&gt;localsettings/python&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/ldap&#34;&gt;localsettings/ldap&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/users&#34;&gt;localsettings/users&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/editor&#34;&gt;localsettings/editor&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/reconfigure-network&#34;&gt;localsettings/reconfigure-network&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/locales&#34;&gt;localsettings/locales&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/vim&#34;&gt;localsettings/vim&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/env&#34;&gt;localsettings/env&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/repository_dotdeb&#34;&gt;localsettings/repository_dotdeb&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/localrc&#34;&gt;localsettings/localrc&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/mvn&#34;&gt;localsettings/mvn&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/etckeeper&#34;&gt;localsettings/etckeeper&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/rvm&#34;&gt;localsettings/rvm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/grub&#34;&gt;localsettings/grub&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/ssl&#34;&gt;localsettings/ssl&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/git&#34;&gt;localsettings/git&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/screen&#34;&gt;localsettings/screen&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/golang&#34;&gt;localsettings/golang&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/shell&#34;&gt;localsettings/shell&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/groups&#34;&gt;localsettings/groups&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/localsettings/sshkeys&#34;&gt;localsettings/sshkeys&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Services</title>
      <link>/reference/services/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/services/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;Salt States dedicated to install services on the targeted environment&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;states&#34;&gt;States&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services&#34;&gt;services States&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;non exhaustive shortcuts:&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;backup&#34;&gt;backup&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/backup/bacula&#34;&gt;services/backup/bacula&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/backup/dbsmartbackup&#34;&gt;services/backup/dbsmartbackup&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/backup/burp&#34;&gt;services/backup/burp&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/backup/rdiff-backup&#34;&gt;services/backup/rdiff-backup&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;base&#34;&gt;base&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/base/cron&#34;&gt;services/base/cron&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/base/ntp&#34;&gt;services/base/ntp&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/base/dbus&#34;&gt;services/base/dbus&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/base/ssh&#34;&gt;services/base/ssh&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/cache/memcached&#34;&gt;services/cache/memcached&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;misc&#34;&gt;misc&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/collab/etherpad&#34;&gt;services/collab/etherpad&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/queue/rabbitmq&#34;&gt;services/queue/rabbitmq&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/sound/mumble&#34;&gt;services/sound/mumble&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/ftp/pureftpd&#34;&gt;services/ftp/pureftpd&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;db&#34;&gt;db&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/db/mongodb&#34;&gt;services/db/mongodb&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/db/postgresql&#34;&gt;services/db/postgresql&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/db/mysql&#34;&gt;services/db/mysql&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/db/redis&#34;&gt;services/db/redis&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;dns&#34;&gt;dns&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/dns/dhcpd&#34;&gt;services/dns/dhcpd&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/dns/slapd&#34;&gt;services/dns/slapd&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/dns/bind&#34;&gt;services/dns/bind&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;firewall&#34;&gt;firewall&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/shorewall&#34;&gt;services/firewall/shorewall&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/firewalld&#34;&gt;services/firewall/firewalld&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/firewall&#34;&gt;services/firewall/firewall&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/ms_iptables&#34;&gt;services/firewall/ms_iptables&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/fail2ban&#34;&gt;services/firewall/fail2ban&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/firewall/psad&#34;&gt;services/firewall/psad&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;gis&#34;&gt;gis&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/gis/postgis&#34;&gt;services/gis/postgis&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/gis/ubuntugis&#34;&gt;services/gis/ubuntugis&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;http&#34;&gt;http&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/http/nginx&#34;&gt;services/http/nginx&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/http/apache_modfastcgi&#34;&gt;services/http/apache_modfastcgi&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/http/apache&#34;&gt;services/http/apache&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/http/apache_modfcgid&#34;&gt;services/http/apache_modfcgid&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/java/tomcat&#34;&gt;services/java/tomcat&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/http/apache_modproxy&#34;&gt;services/http/apache_modproxy&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;log&#34;&gt;log&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/log/rsyslog&#34;&gt;services/log/rsyslog&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/log/ulogd&#34;&gt;services/log/ulogd&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;mail&#34;&gt;Mail&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/mail/dovecot&#34;&gt;services/mail/dovecot&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/mail/postfix&#34;&gt;services/mail/postfix&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;monitoring&#34;&gt;Monitoring&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/client&#34;&gt;services/monitoring/client&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/icinga_web2&#34;&gt;services/monitoring/icinga_web2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/icinga&#34;&gt;services/monitoring/icinga&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/nagvis&#34;&gt;services/monitoring/nagvis&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/icinga2&#34;&gt;services/monitoring/icinga2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/pnp4nagios&#34;&gt;services/monitoring/pnp4nagios&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/icinga_web&#34;&gt;services/monitoring/icinga_web&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/monitoring/snmpd&#34;&gt;services/monitoring/snmpd&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;php&#34;&gt;php&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/php/common&#34;&gt;services/php/common&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/php/modphp&#34;&gt;services/php/modphp&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/php/phpfpm&#34;&gt;services/php/phpfpm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/php/phpfpm_with_apache&#34;&gt;services/php/phpfpm_with_apache&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/php/phpfpm_with_nginx&#34;&gt;services/php/phpfpm_with_nginx&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;proxy&#34;&gt;Proxy&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/proxy/haproxy&#34;&gt;services/proxy/haproxy&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/proxy/uwsgi&#34;&gt;services/proxy/uwsgi&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;virt&#34;&gt;virt&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;th&gt;State&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/virt/docker&#34;&gt;services/virt/docker&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/virt/kvm&#34;&gt;services/virt/kvm&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/virt/lxc&#34;&gt;services/virt/lxc&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/virt/virtualbox&#34;&gt;services/virt/virtualbox&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Services Managers</title>
      <link>/reference/servicesmanagers/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/servicesmanagers/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;In makina-states services managers act on top of services to manage
their lifecycle (start/stop/restart/reload).&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;systemd&#34;&gt;systemd&lt;/h2&gt;

&lt;h2 id=&#34;circus&#34;&gt;circus&lt;/h2&gt;

&lt;h2 id=&#34;supervisor&#34;&gt;supervisor&lt;/h2&gt;
</description>
    </item>
    
    <item>
      <title>Macros</title>
      <link>/reference/macros/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/macros/</guid>
      <description>

&lt;p&gt;Here are a non exhaustive list of macros that makina-states provides and you
may use in your states.&lt;/p&gt;

&lt;h2 id=&#34;helpers&#34;&gt;Helpers&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/_macros/h.jinja&#34;&gt;h(helpers)&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;deliver_deliver_config_files&lt;/strong&gt;: push  configuration files&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;service_restart_reload&lt;/strong&gt;: aim to restart or reload service
but handle the case where services mis implement the status
function and mess salt modules.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;toggle_service&lt;/strong&gt;: helper to call &lt;strong&gt;service_restart_reload&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ssl&#34;&gt;ssl&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/localsettings/ssl/macros.jinja&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;install_certificate&lt;/li&gt;
&lt;li&gt;install_cert_in_dir&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;nginx&#34;&gt;nginx&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/http/nginx/macros.sls&#34;&gt;nginx&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/http/nginx/macros.sls#L31&#34;&gt;nginx.vhost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;apache&#34;&gt;apache&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/http/apache/macros.sls&#34;&gt;apache&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/http/apache/macros.sls#L48&#34;&gt;apache.vhost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;php&#34;&gt;php&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/php/macros.sls&#34;&gt;php&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/php/macros.sls#L60&#34;&gt;php.fpm_pool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/php/macros.sls#L135&#34;&gt;php.minimal_index&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/php/macros.sls#L153&#34;&gt;php.toggle_ext&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;mysql&#34;&gt;mysql&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/db/mysql/init.sls&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;mysql_db&lt;/li&gt;
&lt;li&gt;mysql_group&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;postgresql&#34;&gt;postgresql&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/db/postgresql/init.sls&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;postgresql_db&lt;/li&gt;
&lt;li&gt;postgresql_user&lt;/li&gt;
&lt;li&gt;postgresql_group&lt;/li&gt;
&lt;li&gt;install_pg_exts&lt;/li&gt;
&lt;li&gt;install_pg_ext&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;circusd&#34;&gt;circusd&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services_managers/circus/macros.jinja&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;circusAddWatcher&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;supervisord&#34;&gt;supervisord&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services_managers/supervisor/macros.jinja&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;supervisorAddProgram&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;mongodb&#34;&gt;mongodb&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/db/mongodb/macros.sls&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;mongodb_db&lt;/li&gt;
&lt;li&gt;mongodb_user&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;uwsgi&#34;&gt;uwsgi&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/v2/salt/makina-states/services/proxy/uwsgi&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;config&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;rabbitmq&#34;&gt;rabbitmq&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/salt/makina-states/services/queue/rabbitmq/macros.sls&#34;&gt;macros&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;rabbitmq_vhost&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Projects</title>
      <link>/reference/projects/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/projects/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;This page is the most important thing you ll have to read about
makina-states as a &lt;strong&gt;developer consumer&lt;/strong&gt;, take the time it needs and
deserves.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Never be afraid to go read makina-states code, it will show you how to
configure and extend it. It is simple python and yaml.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;See python exemples:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/master/mc_states/modules&#34;&gt;the modules&lt;/a&gt;
(&lt;a href=&#34;https://docs.saltstack.com/en/latest/ref/modules/&#34;&gt;saltstack doc about
modules&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/makina-states/tree/master/mc_states/states&#34;&gt;the states&lt;/a&gt;
(&lt;a href=&#34;https://docs.saltstack.com/en/latest/ref/states/&#34;&gt;saltstack doc about
states&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;list-of-templates-for-inspiration&#34;&gt;List of templates for inspiration&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../templates&#34;&gt;Templates&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;rfc&#34;&gt;RFC&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;rfc&#34;&gt;RFC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Projects RFC</title>
      <link>/reference/projects/RFC/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/projects/RFC/</guid>
      <description>

&lt;h1 id=&#34;rfc-corpus-embedded-project-configuration-with-salt&#34;&gt;RFC: corpus, embedded project configuration with salt&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;b&gt;ORIGINAL 2012 DOCUMENT ACCUSING ITS AGE and converted to markdown&lt;/b&gt;&lt;/li&gt;
&lt;li&gt;You&amp;rsquo;d better to read the &lt;a href=&#34;https://github.com/makinacorpus/makina-states/blob/v2/doc/sphinx/v1/usage_projects/project_corpus.rst&#34;&gt;Original RST Document&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;the-origin&#34;&gt;The origin&lt;/h2&gt;

&lt;p&gt;Nowoday no one of the P/I/S/aaS existing platforms fit our needs and
habits. No matter of the gret quality of docker, heroku or openshift,
they did&amp;rsquo;nt make it for us. And, really, those software are great, they
inspired corpus a lot ! Please note also, that in the long run we
certainly and surely integrate those as plain &lt;strong&gt;corpus&lt;/strong&gt; drivers to
install our projects on !&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;For exemple, this is not a critisism at all, but that&amp;rsquo;s why we were not
enougth to choose one of those platforms (amongst all of the others):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://heroku.com/&#34;&gt;heroku&lt;/a&gt;: non free&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;http://docker.io&#34;&gt;docker&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Not enougth stable yet, networking integration is really a
problem here. It is doable, but just complicated and out
of scope.&lt;/li&gt;
&lt;li&gt;do not implement all of our needs, it is more tied to the
&amp;lsquo;guest&amp;rsquo; part (see next paragraphs)&lt;/li&gt;
&lt;li&gt;But ! Will certainly replace the LXC guests driver in the
near future.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://www.openshift.com/developers/deploying-and-building-applications&#34;&gt;openshift&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Tied to SElinux and RedHat (we are more on the Debian front ;)).
However, its great design inspired a lot of the corpus one.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://www.openstack.org/&#34;&gt;openstack&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Irrelevant and not so incompatible for the PaaS platform, but
again we didn&amp;rsquo;t want locking, openstack would lock us in the first
place. We want an agnostic PaaS Platform.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;the-needs&#34;&gt;The needs&lt;/h2&gt;

&lt;p&gt;That&amp;rsquo;s why we created a set of tools to build the best flexible PaaS
platform ever. That&amp;rsquo;s why we call that not a PaaS platform but a Glue
PaaS Platform :=).
-   Indeed, what we want is more of a CloudController + ToolBox +
    Dashboards + API.
-   This one will be in charge of making projects install any kind of
    compute nodes running any kind of VMs smoothly and flawlessly.
-   Those projects will never ever be installed directly on compute
    nodes but rather be isolated.
    -   They will be isolated primarly by isolation-level
        virtualisation systems (LXC, docker, VServer)
    -   Bue they must also be installable on plain VMs (KVM, Xen) or
        directly baremetal.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;We don&amp;rsquo;t want any PaaS platform to suffer from some sort of lockin.&lt;/li&gt;
&lt;li&gt;We prefer a generic deployment solution that scale, and better
AUTOSCALE !&lt;/li&gt;
&lt;li&gt;All the glue making the configuration must be centralized and
automatically orchestrated.&lt;/li&gt;
&lt;li&gt;This solution must not be tied to a specific tenant (baremetal, EC2)
nor a guest driver type (LXC, docker, XEN).&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Corrolary, the &lt;strong&gt;low level&lt;/strong&gt; daily tasks consists in managment of:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;network ( &amp;lt; &lt;a href=&#34;http://en.wikipedia.org/wiki/OSI_model#Layer_3:_network_layer&#34;&gt;OSI
L3&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;DNS&lt;/li&gt;
&lt;li&gt;Mail&lt;/li&gt;
&lt;li&gt;operationnal supervision&lt;/li&gt;
&lt;li&gt;Security, IDS &amp;amp; Firewalling&lt;/li&gt;
&lt;li&gt;storage&lt;/li&gt;
&lt;li&gt;user management&lt;/li&gt;
&lt;li&gt;baremetal machines&lt;/li&gt;
&lt;li&gt;hybrid clouds&lt;/li&gt;
&lt;li&gt;public clouds&lt;/li&gt;
&lt;li&gt;VMs&lt;/li&gt;
&lt;li&gt;containers (vserver, LXC, docker)&lt;/li&gt;
&lt;li&gt;operationnal supervision&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Eventually, on top of that orchestrate projects on that
infrastructure&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;installation&lt;/li&gt;
&lt;li&gt;continenous delivery&lt;/li&gt;
&lt;li&gt;intelligent test reports, deployment reports, statistic,
delivery &amp;amp; supervision dashboards&lt;/li&gt;
&lt;li&gt;backups&lt;/li&gt;
&lt;li&gt;autoscale&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is for now the pieces or technologies we use or are planning or
already using to achieve all of those goals:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Developer environments

&lt;ul&gt;
&lt;li&gt;makina-corpus/vms + makina-corpus/makina-states + saltstack/salt&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Bare metal machines provision

&lt;ul&gt;
&lt;li&gt;makina-states + saltstack&lt;/li&gt;
&lt;li&gt;Ubuntu server&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;VMs (guests)

&lt;ul&gt;
&lt;li&gt;Ubuntu based lxc-utils LXC containers + makina-states +
saltstack&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;DNS:

&lt;ul&gt;
&lt;li&gt;makina-states + bind: local cache dns servers &amp;amp; for the moment
dns master for all zones&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FUTURE&lt;/strong&gt; makina-states + powerdns: dynamic managment of all
DNS zones&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Filesystem Backup

&lt;ul&gt;
&lt;li&gt;burp&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Database backup

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kiorky/db_smart_backup&#34;&gt;db_smart_backup&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Network:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ceph, openvswitch&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Logs, stats:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;now: icinga2 / pnp for nagios&lt;/li&gt;
&lt;li&gt;future: icinga2 / logstash / kibana&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Mail&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;postfix&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;User managment (directory)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Fusion directory + openldap&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Security&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;at least shorewall &amp;amp; fail2ban&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;CloudController&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;saltstack&lt;/li&gt;
&lt;li&gt;makina-states + makina-states/mastersalt+ansible&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;projects installation, upgrades &amp;amp; contineous delivery&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;makina-states (mc_project, project_creation)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;autoscale&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;makina-states&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;the-whole-idea&#34;&gt;The whole idea&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;The basic parts of corpus PaaS platform:

&lt;ul&gt;
&lt;li&gt;The cloud controller&lt;/li&gt;
&lt;li&gt;The cloud controller client applications&lt;/li&gt;
&lt;li&gt;The compute nodes

&lt;ul&gt;
&lt;li&gt;Where are hosted guests

&lt;ul&gt;
&lt;li&gt;Where projects run on&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;The developer environments which are just a special kind of
compute nodes&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The first thing we will have is a classical makina-states installation
in mastersalt mode. We then will have salt cloud as a cloud controller
to control compute nodes via &lt;strong&gt;makina-states.services.cloud.{lxc,
saltify, &amp;hellip;}&lt;/strong&gt; (lxc or saltify) Those compute nodes will install
guests. Those guests will eventually run the final projects pushed by
users.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Hence an api and web interface to the controller we can:

&lt;ul&gt;
&lt;li&gt;Add one or more ssh key to link to the host&lt;/li&gt;
&lt;li&gt;Request to link a new compute node&lt;/li&gt;
&lt;li&gt;Request to initialize a new compute node&lt;/li&gt;
&lt;li&gt;List compute nodes with their metadata (ip, dns, available slots,
guest type)&lt;/li&gt;
&lt;li&gt;Get compute ndoos/container/vms base informations (ssh ip / port,
username, pasword, dns names)&lt;/li&gt;
&lt;li&gt;Link more dns to the box&lt;/li&gt;
&lt;li&gt;Manage (add or free) the local storage.&lt;/li&gt;
&lt;li&gt;Destroy a container&lt;/li&gt;
&lt;li&gt;Unlink a compute node&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The users will just have either: - Push the new code to deploy - Connect
via ssh to do extra manual stuff if any including a manual deployment&lt;/p&gt;

&lt;h2 id=&#34;permission-accesses&#34;&gt;Permission accesses&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;We will use an ldap server to perform authentication&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;the-different-environment-platforms&#34;&gt;The different environment platforms&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;We also want to distinguish at least those 3 environments, so 3 ways for
you to deploy at least.

&lt;ul&gt;
&lt;li&gt;dev: The developper environments (laptop)&lt;/li&gt;
&lt;li&gt;staging: the stagings and any other QA platform&lt;/li&gt;
&lt;li&gt;prod: the production platform&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;objectives&#34;&gt;Objectives&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;The layout and projects implementation must allow us to

&lt;ul&gt;
&lt;li&gt;Automaticly rollback any unsucessful deployment&lt;/li&gt;
&lt;li&gt;In production and staging, archive application content from N last
deployments&lt;/li&gt;
&lt;li&gt;Make the development environment easily editable&lt;/li&gt;
&lt;li&gt;Make the staging environment a production battletest server&lt;/li&gt;
&lt;li&gt;Production can deploy from non complex builds, and the less possible
dependant of external services&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;For this, we inspired ouselves a lot from

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.openshift.com/developers/deploying-and-building-applications&#34;&gt;openshift&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;and &lt;a href=&#34;https://devcenter.heroku.com/articles/buildpack-api&#34;&gt;heroku&lt;/a&gt;
(custom buildpacks) models.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;actual-layout&#34;&gt;Actual layout&lt;/h2&gt;

&lt;h3 id=&#34;overview-of-the-project-source-code-repositories&#34;&gt;Overview of the project source code repositories&lt;/h3&gt;

&lt;p&gt;A project will have at least 2 local git repositories:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/srv/projects/myproject/git/project.git/
  A repository where lives its sourcecode and deployment recipes
/srv/projects/myproject/git/pillar.git/
  A repository where lives its pillar
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This repository master branch consequently has the minimal following
structure:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;master
    |- what/ever/files/you/want
    |- .salt -&amp;gt; the salt deployment structure
    |- .salt/PILLAR.sample     -&amp;gt; default pillar used in the project, this
    |                             file will be loaded inside your
    |                             configuration
    |- .salt/rollback.sls      -&amp;gt; rollback code run in case of problems
    |- .salt/archive.sls       -&amp;gt; pre save code which is run upon a deploy
    |                             trigger
    |- .salt/fixperms.sls      -&amp;gt; reset permissions script run at the end of
    |                            deployment
    |- .salt/_modules          -&amp;gt; custom salt modules to add to local salt
    |       /_runners             install
    |       /_outputters
    |       /_states
    |       /_pillars
    |       /_renderers
    |
    |- .salt/00_DEPLOYMENT.sls -&amp;gt; all other slses will be executed in order
                                  and are to be provided by th users.
&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;A private repository with restricted access with any configuration
data needed to deploy the application on the PAAS platform. This is
in our case the project pillar tree:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pillar master
   |- init.sls the pillar configuration
&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As anyways, you ll push changes to the PAAS platform, no matter what you
push, the PAAS platform will construct according to the pushed code :).
So you can even git push -f if you want to force things.&lt;/p&gt;

&lt;h3 id=&#34;overview-of-the-paas-local-directories&#34;&gt;Overview of the paas local directories&lt;/h3&gt;

&lt;dl&gt;
&lt;dt&gt;/srv/projects/myproject/project/&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;The local clone of the project branch from where we run in all
modes. In other words, this is where the application runtimes files
are. In application speaking&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;django/python ala pip:&lt;/strong&gt; the virtualenv &amp;amp; root of runtime
generated configuration files&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;zope:&lt;/strong&gt; this will the root where the bin/instance will be
lauched and where the buildout.cfg is&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;php webapps:&lt;/strong&gt; this will be your document root + all
resources&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nodejs:&lt;/strong&gt; etc, this will be where nginx search for static
files and where the nodejs app resides.&lt;/li&gt;
&lt;/ul&gt;&lt;/dd&gt;
&lt;dt&gt;/srv/projects/myproject/pillar&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;The project specific states pillar tree local clone.&lt;/p&gt;&lt;/dd&gt;
&lt;dt&gt;/srv/projects/myproject/data/&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;Where must live any persistent data&lt;/p&gt;&lt;/dd&gt;
&lt;dt&gt;/srv/pillar/makina-projects/myproject -&amp;gt; /srv/projects/myproject/pillar&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;pillar symlink for salt integration&lt;/p&gt;&lt;/dd&gt;
&lt;dt&gt;/srv/salt/makina-projects/myproject -&amp;gt; /srv/projects/myproject/.salt/&amp;lt;env&amp;gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;state tree project symlink for salt integration&lt;/p&gt;&lt;/dd&gt;
&lt;dt&gt;/srv/salt/{_modules,runners,outputters,states,pilalrs,renderers}/*py -&amp;gt; /srv/projects/myproject/.salt/&amp;lt;typ&amp;gt;/mod.py&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;custom salt python execution modules&lt;/p&gt;&lt;/dd&gt;
&lt;/dl&gt;

&lt;p&gt;The deployment procedure is as simple a running meta slses which in turn
call your project ones contained in a subfolder of the &lt;strong&gt;.salt&lt;/strong&gt;
directory during the &lt;strong&gt;install&lt;/strong&gt; phase.&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;.salt&lt;/strong&gt; directory will contain SLSs executed in lexicographical
order. You will have to take exemple on another projects inside
&lt;strong&gt;makina-states/projects&lt;/strong&gt; or write your states. Those slses are in
charge to install your project.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The &lt;strong&gt;persistent configuration directories&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;/etc&lt;/p&gt;

&lt;dl&gt;
&lt;dd&gt;static global configuration (/etc)&lt;/dd&gt;
&lt;/dl&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;the &lt;strong&gt;persistent data directories&lt;/strong&gt;:&lt;br/&gt;
If you want to deploy something inside, make a new archive in
the release directory with a dump or a copy of one of
those files/directories.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  /var

  :   Global data directories (data &amp;amp; logs) (/var) Minus the
      package manager cache related directories

  /srv/projects/project/data

  :   Specific application datas (/srv/projects/project/data)

      -   Datafs and logs in zope world
      -   drupal thumbnails
      -   mongodb documentroot
      -   ...
&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Networkly speaking&lt;/strong&gt;, to enable switch of one container to another
we have some solutions but in any case, &lt;strong&gt;no ports&lt;/strong&gt; must be
&lt;strong&gt;directly&lt;/strong&gt; wired to the container. &lt;strong&gt;Never EVER&lt;/strong&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Either:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Make the host receive the inbound traffic data and redirect (NAT) it
to the underlying container&lt;/li&gt;
&lt;li&gt;Make a proxy container receive all dedicated traffic and then this
specific container will redirect the traffic to the real underlying
production container.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;procedures&#34;&gt;Procedures&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Those procedure will be implemented by either:

&lt;ul&gt;
&lt;li&gt;Manual user operations or commands&lt;/li&gt;
&lt;li&gt;Git hooks&lt;/li&gt;
&lt;li&gt;salt execution modules&lt;/li&gt;
&lt;li&gt;jinja macros (collection of saltstack states)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All procedures are tied to a &lt;strong&gt;default&lt;/strong&gt; sls inside the &lt;strong&gt;.salt&lt;/strong&gt;
project folder and can per se be overriden.&lt;/p&gt;

&lt;h3 id=&#34;project-initialization-sync-procedure&#34;&gt;Project initialization/sync procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Initiate the project specific user&lt;/li&gt;
&lt;li&gt;Initiate the ssh keys if any&lt;/li&gt;
&lt;li&gt;Initiate the pillar and project bare git repositories inside the git
folder&lt;/li&gt;
&lt;li&gt;Clone local copies inside the project, pillar and salt directories&lt;/li&gt;
&lt;li&gt;If the salt folder does not exists, create it&lt;/li&gt;
&lt;li&gt;If any of default slses procedures are not yet present, create them&lt;/li&gt;
&lt;li&gt;Wire the pillar configuration inside the pillar root&lt;/li&gt;
&lt;li&gt;Wire the pillar init.sls file to the global pillar top file&lt;/li&gt;
&lt;li&gt;Wire the salt configuration inside the salt root&lt;/li&gt;
&lt;li&gt;Echo the git remotes to push the new deployement on.&lt;/li&gt;
&lt;li&gt;Wire any salt modules in .salt/{_modules,runners,etc}&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;project-archive-procedure&#34;&gt;Project archive procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;If size is low, we enlarge the container&lt;/li&gt;
&lt;li&gt;run the pre archive hooks&lt;/li&gt;
&lt;li&gt;archive the &lt;strong&gt;project&lt;/strong&gt; directory in an &lt;strong&gt;archive/deployed&lt;/strong&gt;
subdirectory&lt;/li&gt;
&lt;li&gt;run the post archive hooks (make extra dumps or persistent
data copies)&lt;/li&gt;
&lt;li&gt;run the archives rotation job&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;project-release-sync-procedure&#34;&gt;Project Release-sync procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Be sure to sync the last git deploy hook from makina-states&lt;/li&gt;
&lt;li&gt;Fetch the last commits inside the &lt;strong&gt;deploy&lt;/strong&gt; directory&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;project-install-procedure&#34;&gt;Project install procedure&lt;/h3&gt;

&lt;p&gt;We run all slses in the project &lt;strong&gt;.salt&lt;/strong&gt; directory which is not tied to
any default procedure.&lt;/p&gt;

&lt;h3 id=&#34;project-fixperms-procedure&#34;&gt;Project fixperms procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Set &amp;amp; &lt;strong&gt;reset (enforce)&lt;/strong&gt; needed user accesses to the filesystem&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;rollback-procedure&#34;&gt;Rollback procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Only run if something have gone wrong&lt;/li&gt;
&lt;li&gt;We move the failed &lt;strong&gt;project&lt;/strong&gt; directory in the deployment
&lt;strong&gt;archives/&amp;lt;UUID&amp;gt;/project.failed&lt;/strong&gt; sub directory&lt;/li&gt;
&lt;li&gt;We sync back the previous deployment code to the &lt;strong&gt;project&lt;/strong&gt;
directory&lt;/li&gt;
&lt;li&gt;We execute the rollback hook (user can input database dumps reload)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;workflows&#34;&gt;Workflows&lt;/h2&gt;

&lt;h3 id=&#34;full-procedure&#34;&gt;Full procedure&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;project &lt;strong&gt;deployment&lt;/strong&gt; is triggered&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;archive&lt;/strong&gt; procedure&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;initialization/sync&lt;/strong&gt; procedure&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;release-sync&lt;/strong&gt; procedure&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;fixperms&lt;/strong&gt; procedure&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;install&lt;/strong&gt; procedure&lt;/li&gt;
&lt;li&gt;project &lt;strong&gt;fixperms&lt;/strong&gt; procedure (yes again)&lt;/li&gt;
&lt;li&gt;In error: &lt;strong&gt;rollback&lt;/strong&gt; procedure&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;implementation-how-a-project-is-built-and-deployed&#34;&gt;IMPLEMENTATION: How a project is built and deployed&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;For now, at makinacorpus, we think this way:

&lt;ul&gt;
&lt;li&gt;Installing somewhere a mastersalt master controlling compute nodes
and only accessible by &lt;strong&gt;ops&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Installing elsewhere at least one compute node which will receive
project nodes (containers):

&lt;ul&gt;
&lt;li&gt;linked to this mastersalt as a mastersalt minion&lt;/li&gt;
&lt;li&gt;a salt minion linked to a salt master which is probably local
and controlled by &lt;strong&gt;project members aka devs&lt;/strong&gt;, by default
these salt minion and salt master services are toggled off and
the salt-call should be runned &lt;strong&gt;masterless&lt;/strong&gt;
(salt-call &amp;ndash;local)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;initialisation-of-a-cloud-controller&#34;&gt;Initialisation of a cloud controller&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Complex, contact &lt;a href=&#34;mailto:sysadmin@makina-corpus.com&#34;&gt;@makinacorpus&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;This incude:

&lt;ul&gt;
&lt;li&gt;Setting up the dns master &amp;amp; slaves for the cloud controlled zone.&lt;/li&gt;
&lt;li&gt;Setting up the cloud database&lt;/li&gt;
&lt;li&gt;Setting up at least one compute node to deploy projects&lt;/li&gt;
&lt;li&gt;Deploying vms&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;request-of-a-compute-node-or-a-container&#34;&gt;Request of a compute node or a container&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Edit the mastersalt database file to include your compute node and
vms configuration.&lt;/li&gt;
&lt;li&gt;Run any appropriate mastersalt runners to deploy &amp;amp; operate your
compute nodes and vms&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;initialisation-of-a-compute-node&#34;&gt;Initialisation of a compute node&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;This will in order:

&lt;ul&gt;
&lt;li&gt;auth user&lt;/li&gt;
&lt;li&gt;check infos to attach a node via salt cloud&lt;/li&gt;
&lt;li&gt;Register DNS in the dns master for thie compute node and its related
vms&lt;/li&gt;
&lt;li&gt;generate a new ssh key pair&lt;/li&gt;
&lt;li&gt;install the guest_type base system
(eg: makina-states.services.virt.lxc)&lt;/li&gt;
&lt;li&gt;Generate root credentials and store them in grains on mastersalt&lt;/li&gt;
&lt;li&gt;Configure the basic container pillar on mastersalt

&lt;ul&gt;
&lt;li&gt;root credentials&lt;/li&gt;
&lt;li&gt;dns&lt;/li&gt;
&lt;li&gt;firewall rules&lt;/li&gt;
&lt;li&gt;defaultenv (dev, prod, preprod)&lt;/li&gt;
&lt;li&gt;compute mode override if any (default_env
inside /srv/salt/custom.sls)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Run the mastersalt highstate.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;initialisation-of-a-project-container-environment&#34;&gt;Initialisation of a project - container environment&lt;/h3&gt;

&lt;p&gt;This will in order:
-   auth user
-   Create a new container on endpoint with those root credentials
-   Create the layout
-   use the desired salt cloud driver to attach the distant host as a
    new minion
-   install the key pair to access the box as root
-   Generate root credentials and store them in grains on mastersalt
-   Configure the basic container pillar on mastersalt
    -   root credentials
    -   dns
    -   firewall rules
-   Run the mastersalt highstate&lt;/p&gt;

&lt;h3 id=&#34;initialisation-of-a-project&#34;&gt;Initialisation of a project&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;We run the initalization/sync project procedure&lt;/li&gt;
&lt;li&gt;Send a mail to sysadmins, or a bot, and initial igniter with the
infos of the new platform access

&lt;ul&gt;
&lt;li&gt;basic http &amp;amp; https url access&lt;/li&gt;
&lt;li&gt;ssh accces&lt;/li&gt;
&lt;li&gt;root credentials&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;User create the project&lt;/li&gt;
&lt;li&gt;Project directories are initialised&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;upgrade-of-a-project&#34;&gt;upgrade of a project&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;The code is not pull by production server it will be pushed with git to
the environment ssh endpoint:

&lt;ul&gt;
&lt;li&gt;Triggered either by an automatted bot (jenkins)&lt;/li&gt;
&lt;li&gt;By the user itself, hence he as enougth access&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;In either way, the trigger is a git push.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;the-nerve-of-the-war-jinja-macros-and-states-and-execution-modules&#34;&gt;The nerve of the war: jinja macros and states, and execution modules&lt;/h3&gt;

&lt;p&gt;Project states writing is done by layering a set of saltstacl &lt;strong&gt;sls&lt;/strong&gt;
files in a certain order. Those will ensure an automatic deployment from
end to end. The salt states and macros will abuse of execution modules
to gather informations but also act on the underlying system.&lt;/p&gt;

&lt;h3 id=&#34;the-project-common-data-structure&#34;&gt;The project common data structure&lt;/h3&gt;

&lt;h4 id=&#34;overview&#34;&gt;Overview&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;to factorize the configuration code but also keep track of specific
settings, those macros will use a common data mapping structure
which is good to store defaults but override in a common manner
variables via pillar.&lt;/li&gt;
&lt;li&gt;all those macros will take as input this &lt;strong&gt;configuration&lt;/strong&gt; data
structure which is a mapping containing all variables and metadata
about your project.&lt;/li&gt;
&lt;li&gt;this common data mapping is not copied over but passed always as a
reference, this mean that you can change settings in a macro and see
those changes in later macros.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;the-project-configuration-registry-execution-module-helper&#34;&gt;The project configuration registry execution module helper&lt;/h3&gt;

&lt;p&gt;The base execution module used for project management is
module_mc_project&lt;/p&gt;

&lt;p&gt;It will call under the hood the latest &lt;strong&gt;API&lt;/strong&gt; version of the
mc_project module.&lt;/p&gt;

&lt;p&gt;eg: &lt;code&gt;mc_project_2.*&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This will define methods for:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Crafting the base &lt;strong&gt;configuration&lt;/strong&gt; data structure&lt;/li&gt;
&lt;li&gt;initialising the project filesystem layout, pillar and downloading
the base sourcecode for deployment (salt branch)&lt;/li&gt;
&lt;li&gt;deploying and upgrading an already installed project.&lt;/li&gt;
&lt;li&gt;Setting a project configuration&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If there are too many changes in a project layout, obviously a new
project API module should be created and registered for the others to
keep stability.&lt;/p&gt;

&lt;h3 id=&#34;apiv2&#34;&gt;APIV2&lt;/h3&gt;

&lt;h4 id=&#34;the-project-execution-module-interface-apiv2&#34;&gt;The project execution module interface (APIV2)&lt;/h4&gt;

&lt;p&gt;Note that there two parts in the module:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;One set of methods are the one you are most likely to use handle
local deployment&lt;/li&gt;
&lt;li&gt;One another set of methods is able to handle remote deployments over
ssh. The only requirement for the other host is that makina-states
should be installed first and ssh access should be configured
previously to any deploy call. The requirement was to have only a
basic ssh access, that why we did not go for a RAET or 0Mq salt
deployment structure here.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;See module_mc_project_2&lt;/p&gt;

&lt;h4 id=&#34;the-project-sls-interface-apiv2&#34;&gt;The project sls interface (APIV2)&lt;/h4&gt;

&lt;p&gt;Each project must define a set of common sls which will be the
interfaced and orchestred by the project execution module. Theses sls
follow the aforementionned procedures style.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The important thing to now remember is that those special sls files
cannot be run without the project runner execution module&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Indeed, we inject in those sls contextes a special &lt;strong&gt;cfg&lt;/strong&gt; variable
which is the project configuration and without we can&amp;rsquo;t deploy
correctly.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;We have two sets of sls to consider&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The set of sls providen by a makina-states &lt;strong&gt;installer&lt;/strong&gt;:&lt;br/&gt;
this is specified at project creation and stored in
configuration for further reference&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The set of sls providen by the project itself in the .salt directory&lt;br/&gt;
&lt;strong&gt;this is where the user will customize it&amp;rsquo;s deployment
steps&lt;/strong&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The installer set is then included by default at the first generation of
the user installer set at the creation of the project.&lt;/p&gt;

&lt;h2 id=&#34;project-initialisation-installation&#34;&gt;Project initialisation &amp;amp; installation&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Refer to project_creation&lt;/li&gt;
&lt;li&gt;Some installers example: projects_project_list&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Templates</title>
      <link>/reference/templates/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reference/templates/</guid>
      <description>

&lt;p&gt;Those projects can be used as-is or as a kickstarter for your own projects
based on makina-states either by copying or inspiring yourself to create your own&lt;/p&gt;

&lt;h1 id=&#34;project-skeletons-compliant-with-makina-states&#34;&gt;Project skeletons compliant with makina-states&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-drupal&#34;&gt;corpus-drupal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-php&#34;&gt;corpus-php&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-django&#34;&gt;corpus-django&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-zope-plone&#34;&gt;corpus-zope-plone&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-staticwww&#34;&gt;corpus-staticwww&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;databases&#34;&gt;databases&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-solr&#34;&gt;corpus-solr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-mysql&#34;&gt;corpus-mysql&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-elasticsearch&#34;&gt;corpus-elasticsearch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-mongodb&#34;&gt;corpus-mongodb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-rabbitmq&#34;&gt;corpus-rabbitmq&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-pgsql&#34;&gt;corpus-pgsql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;webapps&#34;&gt;webapps&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-seafile&#34;&gt;corpus-seafile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-redmine&#34;&gt;corpus-redmine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-vaultier&#34;&gt;corpus-vaultier&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-fusiondirectory&#34;&gt;corpus-fusiondirectory&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-sabnzbd&#34;&gt;corpus-sabnzbd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-legacyenketo&#34;&gt;corpus-legacyenketo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-odoo&#34;&gt;corpus-odoo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-piwik&#34;&gt;corpus-piwik&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;osm&#34;&gt;Osm&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-osmdb&#34;&gt;corpus-osmdb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-osmrender&#34;&gt;corpus-osmrender&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-tilemill&#34;&gt;corpus-tilemill&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;code-ci&#34;&gt;Code &amp;amp; CI&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-gitlab&#34;&gt;corpus-gitlab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-jenkins&#34;&gt;corpus-jenkins&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-jenkins-slave&#34;&gt;corpus-jenkins-slave&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-svn&#34;&gt;corpus-svn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-gitlabrunner&#34;&gt;corpus-gitlabrunner&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;misc&#34;&gt;Misc&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-mumble&#34;&gt;corpus-mumble&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-irssi&#34;&gt;corpus-irssi&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;mail&#34;&gt;Mail&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/makinacorpus/corpus-mailman3&#34;&gt;corpus-mailman3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>