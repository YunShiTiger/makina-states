# MANAGED VIA SALT DO NOT EDIT
{% for rhost in vms %}
{% set host = salt['mc_cloud_controller.gen_id'](rhost) %}
{% for rid, data in profiles.items() %}
{% set id = salt['mc_cloud_controller.gen_id'](rid) %}
ms-{{host}}-{{id}}-lvm:
  provider: {{host}}-lxc
  from_container: {{pdata.default_container}}
  backing: lvm
  sudo: True
  size: {{data.size}}
  ssh_gateway: {{pdata.gateway}}
  script: {{msr}}/_scripts/boot-salt.sh
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

ms-{{host}}-{{id}}-lvm-sratch:
  provider: {{host}}-lxc
  image: ubuntu
  ssh_gateway: {{pdata.gateway}}
  backing: lvm
  sudo: True
  size: {{data.size}}
  script: {{msr}}/_scripts/boot-salt.sh
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

{% endfor %}

ms-{{host}}-dir:
  provider: {{host}}-lxc
  from_container: {{pdata.default_container}}
  ssh_gateway: {{pdata.gateway}}
  backing: dir
  sudo: True
  script: {{msr}}/_scripts/boot-salt.sh
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

ms-{{host}}-dir-scratch:
  provider: {{host}}-lxc
  ssh_gateway: {{pdata.gateway}}
  image: ubuntu
  backing: dir
  sudo: True
  script: {{msr}}/_scripts/boot-salt.sh
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

ms-{{host}}-overlayfs:
  provider: {{host}}-lxc
  from_container: {{pdata.default_container}}
  ssh_gateway: {{pdata.gateway}}
  backing: overlayfs
  sudo: True
  script: {{msr}}/_scripts/boot-salt.sh
  snapshot: true
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

ms-{{host}}-overlayfs-scratch:
  provider: {{host}}-lxc
  ssh_gateway: {{pdata.gateway}}
  image: ubuntu
  backing: overlayfs
  sudo: True
  script: {{msr}}/_scripts/boot-salt.sh
  script_args: -C --from-salt-cloud -no-M
  minion:
    master: {{cdata.master}}
    master_port: {{cdata.master_port}}

{% endfor %}
# vim:set ft=sls:
