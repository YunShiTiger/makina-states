# MANAGED VIA SALT, DO NOT EDIT
# Set ENABLED to 1 if you want the init script to start haproxy.
# {% set data = salt['mc_haproxy.settings']() %}
PATH=/sbin:/usr/sbin:/bin:/usr/bin
PIDFILE="/var/run/haproxy.pid"
CONFIG="${CONFIG:-"/etc/haproxy/haproxy.cfg"}"
HAPROXY="/usr/sbin/haproxy"
RUNDIR="${RUNDIR:-"/run/haproxy"}"
 
ENABLED="{{data.defaults.enabled}}"
EXTRAOPTS="{% if data.defaults.extra_opts %} {{data.defaults.extra_opts}}{%endif%}"
# Add extra flags here.

#EXTRAOPTS="-de -m 16"
CONFIGDIR=/etc/haproxy
get_opts() {
    opts=""
    for j in backends dispatchers listeners extra;do
        idir="${CONFIGDIR}/${j}"
        if [ -e ${idir} ];then
            for f in $(find "${idir}" -name "*cfg"|sort -nk2);do
                opts="${opts} -f ${f}"
            done
        fi
    done
    echo "${opts}"
}

haproxy_check_perms() {
	[ -d "$RUNDIR" ] || mkdir "$RUNDIR"
	chown haproxy:haproxy "$RUNDIR"
	chmod 2775 "$RUNDIR"
}

EXTRAOPTS="${EXTRAOPTS} $(get_opts)"
