{% macro bck(data) %}
backend {{data.name}}
    mode {{data.get('mode', 'http')}}
{% for opt in data.get('raw_opts', []) %}
    {{opt}}
{% endfor %}
{% for srv in data.get('servers', []) %}
    server {{ srv.name }} {{srv.bind}} {{srv.opts}}
{% endfor %}
{% endmacro %}

{% macro lst(data) %}
listen {{data.name}}
    mode {{data.get('mode', 'http')}}
    bind {{data.bind}}
{% for opt in data.get('raw_opts', []) %}
    {{opt}}
{% endfor %}
{% for srv in data.get('servers', []) %}
    server {{ srv.name }} {{srv.bind}} {{srv.opts}}
{% endfor %}
{%endmacro %}

{% macro front(data) %}
frontend {{data.name}}
    bind {{data.bind}}
    mode {{data.get('mode', 'http')}}
{% for opt in data.get('raw_opts', []) %}
    {{opt}}
{% endfor %}
{%endmacro %}

# http front
{{ front(cdata.http_proxy) }}
{{ front(cdata.https_proxy) }}

# https front
{% for backend in cdata.http_backends %}
{{ bck(backend) }}
{% endfor %}

{% for backend in cdata.https_backends %}
{{ bck(backend) }}
{% endfor %}

# ssh proxies
{% for backend in cdata.ssh_proxies %}
{{ lst(backend) }}
{% endfor %}
