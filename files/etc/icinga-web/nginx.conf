# MANAGED VIA SALT -- DO NOT EDIT
{% set data = salt['mc_utils.json_load'](data) %}
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}
location = / {
    rewrite ^/$ /icinga-web/index.php permanent;
}
location /icinga-web/styles {
    alias /usr/share/icinga-web/pub/styles;
}
location /icinga-web/images {
    alias /usr/share/icinga-web/pub/images;
}
location /icinga-web/js {
    alias /usr/share/icinga-web/lib;
}
location /icinga-web/modules/([A-Za-z0-9]*)/resources/images/([A-Za-z_\-0-9]*\.(png|gif|jpg))$ {
    alias /usr/share/icinga-web/app/modules/$1/pub/images/$2;
}
location /icinga-web/modules/([A-Za-z0-9]*)/resources/styles/([A-Za-z0-9]*\.css)$ {
    alias /usr/share/icinga-web/app/modules/$1/pub/styles/$2;
}
location /icinga-web/modules/BPAddon/resources {
    alias /usr/share/icinga-web/app/modules/BPAddon/pub;
}
location /icinga-web/modules {
    rewrite ^/icinga-web/(.*)$ /icinga-web/index.php?/$1 last;
}
location /icinga-web/web {
    rewrite ^/icinga-web/(.*)$ /icinga-web/index.php?/$1 last;
}
location ~ ^/modules {
    rewrite ^/modules/(.*)$ /icinga-web/modules/$1 permanent;
}
location /icinga-web {
    alias   /usr/share/icinga-web/pub;
    index index.php;
    try_files $uri $uri/ /icinga-web/index.php?$args;
}
location ~ /icinga-web/(.*)\.php($|/) {
    include /etc/nginx/fastcgi_params;
    fastcgi_pass unix:/var/spool/www/icinga_localhost.fpm.sock; # TODO: get socket from data
    fastcgi_index index.php;
    fastcgi_split_path_info ^(/icinga-web/.*\.php)(.*);
    fastcgi_param PATH_INFO $fastcgi_path_info;
#   DOES NOT WORK
#    fastcgi_param PATH_INFO $fastcgi_script_name;
    fastcgi_param SCRIPT_FILENAME /usr/share/icinga-web/pub/index.php;
    fastcgi_param REMOTE_USER $remote_user;
    fastcgi_param PHP_AUTH_USER $remote_user;
}
