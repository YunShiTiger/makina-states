<!DOCTYPE html>
<html lang="en"><head>
<meta name="robots" content="noindex"><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Installation &amp; basic usage | Makina States</title><meta name="description" content="" />
<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="0001-01-01T00:00:00Z" />
<meta property="og:article:modified_time" content="0001-01-01 00:00:00 &#43;0000 UTC" /><meta property="og:article:tag" content="topics" /><meta property="og:article:tag" content="installation" /><meta property="og:locale" content="en_US">
<meta property="og:title" content="Installation &amp; basic usage">
<meta property="og:image" content="/images/">
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="1500" />
<meta property="og:image:height" content="800" />
<meta property="og:description" content=""/>
<meta property="og:site_name" content="Makina States">
<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/images/favicons/manifest.json">
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<link rel="shortcut icon" href="/images/favicons/favicon.ico">
<link rel="dns-prefetch" href="/">

<link rel="preconnect" href="/">
<link rel="canonical" href="/topics/install/">


<link rel="prefetch" href="/topics/haproxy/">
<link rel="prerender" href="/topics/haproxy/">


<link rel="prefetch" href="/topics/ssl/">
<link rel="prerender" href="/topics/ssl/">

<link rel="stylesheet" href="/css/style.min.css">
  
</head>
<body>
	
<header id="site-header" class="site-header">
  <div class="hugo-meta" title="Hugo version 1">
    <a href="/" id="home-link">
      <img src="/images/MakinaCorpus_logo_vert_blanc.svg" alt="" />
    </a>
  </div>
  <div id="goto-source">
    <ul>
      <li>
        <a href="https://github.com/makinacorpus/makinastates/doc/hugo/content/" target="_blank">
          <i class="icon-github"></i> Source
        </a>
      </li>
    </ul>
  </div>
<div id="search-wrapper">
  <form action="" id="search-form" role="search">
    <label for="search" class="icon-search" id="search-button"></label>
    <input type="search" id="search-input" class="site-search"
        autocomplete="off"
        aria-label="Search the Makina States website..."
        placeholder="Search..." required />
    <input type="hidden" id="search-index" value="/site-index.json"/>
  </form>
</div>
<div id="search-results-wrapper">
  <div id="search-results-count"></div>
  <ul id="search-results">
    
    
  </ul>
</div>
</header>

  <div class="all-content-wrapper" id="all-content-wrapper">
		
<span id="page-top"></span>
<main class="main">
	<article class="content" id="installation--basic-usage">
		<header class="content-header">
<nav class="breadcrumb">
	<ul class="breadcrumbs">
		<li>
			<a class="crumb" href="/topics">
    		<span>Topics</span>
  		</a>
		</li>
	</ul>
</nav>

<h1 class="page-title topics" id="installation--basic-usage">Installation &amp; basic usage</h1>
<div class="content-header-links">
  
  <a target="_blank" class="tooltip right edit-link" data-tooltip="Edit this page on GitHub" href="https://github.com/makinacorpus/makinastates/doc/hugo/content/edit/master/content/topics/install/index.md"><i class="icon-pencil" aria-hidden="true"></i></a></div>

	<ul class="tags">
		<li class="icon"><i class="icon-tags"></i></li>
		
		<li><a class="tag" href="/tags/topics">topics</a></li>
		
		<li><a class="tag" href="/tags/installation">installation</a></li>
		
	</ul>


		</header>
		<div class="body-copy" data-section=topics>
		

<h2 id="briefing">Briefing</h2>

<p><strong>For now, use Ubuntu &gt;= 14.04.</strong>. Makina-States can be ported to any
linux based OS, but we here use ubuntu server and this is the only
supported system for now. It can be used in any flavor, lxc, docker,
baremetal, kvm, etc.</p>

<ul>
<li>To install our base salt installation, you have to choose between
different modes of operations tweakable via the <strong>nodetype</strong> setting:

<ul>
<li>The regular preset modes manages the system configuration from end
to end, from the system, to makina-states, including the
saltstack/salt/ansible installation itself.</li>
<li>The special <code>scratch</code> mode manages only the saltstack +
makina-states configuration by default, so it&rsquo;s up to you to apply
any other state but do not touch much to the system itself more
than installing the scripts for wiring makina-states</li>
</ul></li>
</ul>

<p><strong>Makina-states do not use regular salt daemons to operate remotely but
an ansible bridge that copy the pillar and use salt-call locally
directly on the remote box</strong></p>

<h2 id="reminder">Reminder</h2>

<ul>
<li>Makina-states was based at fist on &ldquo;nodetypes presets&rdquo; that are prebundled
collections of makina-states states to apply to the system.

<ul>
<li>On those nodetypes, we manage &ldquo;controllers&rdquo;, aka the states which
configure salt &amp; ansible for operation

<ul>
<li>On those nodetypes, we may configure &ldquo;localsettings&rdquo; like ssl, vim,
git, &amp; basepackages or network configurations. If any other preset
than <strong>scratch</strong> has been activated, many localsettings will be
applied by default
(see mc_states/modules/localsettings.py:registry)</li>
<li>After all of the previous steps, we may configure services like
sshd, crond, or databases. If we are on the <strong>scratch</strong> mode, no
services are configured by default.</li>
<li>Eventually, we may by able to install projects via mc_project. A
project is just a classical code repository which has a &ldquo;.salt&rdquo;
and/or ansible playbooks/roles folder commited with enougth
information on how to deploy it.</li>
</ul></li>
</ul></li>
</ul>

<h2 id="details">Details</h2>

<ul>
<li>Just run the <code>_scrits/boot-salt.sh</code> script as <strong>root</strong>,</li>
<li>Please read next paragraphs before running any command.

<ul>
<li>All the behavior of the script can be controlled via environment
variables or command line arguments switches.</li>
<li>You will need to tell on what kind of environment you are installing
on (the nodetype).</li>
<li>You&rsquo;ll also have to set the <strong>minion id</strong>. The default choice for
<strong>&ndash;minion-id</strong> is the current machine hostname. You should keep
this naming scheme unless you have a good reason to change it.</li>
<li>Your choice for <code>--nodetype</code> is certainly one of:

<ul>
<li><strong>scratch</strong> manages by default only the salt installation and
configuration. You ll want to activate this mode if you want
to apply explicitly your states without relying of default
nodetypes configuration.</li>
<li><strong>server (default)</strong> matches a baremetal server, and manage it
from end to end (base packages, network, locales, sshd, crond,
logrotate, etc, by default)</li>
<li><strong>vm</strong> matches a VM (not baremetal), this is mostly like
<strong>server</strong>.</li>
<li><strong>lxccontainer</strong> matches a VM (not baremetal), this is mostly
like <strong>server</strong>.</li>
<li><strong>laptop</strong> is like server but also install packages for
working on a developement machine (prebacking a laptop for
a dev)</li>
<li><strong>dockercontainer</strong> matches a VM (not baremetal), this is
mostly like <strong>server</strong>, but install &amp; preconfigure circus to
manage daemons.</li>
<li><strong>devhost</strong> is suitable for a development machine enabling
states to act on that, by example installation of a test
local-loop mailer.</li>
<li><strong>vagrantvm</strong> is suitable to flag vagrant boxes and is a
subtype of devhost</li>
</ul></li>
</ul></li>
</ul>

<h2 id="regular-modes-via-boot-salt-sh">Regular modes (via boot-salt.sh)</h2>

<ul>
<li>boot-salt.sh will try to remember how you configured makina-states on
each run. It stores configs in <code>installdir/etc/makina-states</code></li>
<li>Indeed while running, the script try to find enougth information
(nodetype, salt installs, branch), and will automaticly guess &amp; store
the parameters by itself.</li>
<li>In other words, you will just have to type <strong>boot-salt.sh</strong>, and verify
settings the next time you ll use it.</li>
</ul>

<p><strong>REMEMBER THAT FOR NOW YOU HAVE TO USE UBUNTU &gt;= 14.04.</strong></p>

<h3 id="download">Download</h3>

<ul>
<li><p>Get the script:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>git clone http://raw.github.com/makinacorpus/makina-states
</code></pre></div></li>

<li><p>Short overview:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>./boot-salt.sh --help
</code></pre></div></li>

<li><p>Detailed overview:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>./boot-salt.sh --long-help
</code></pre></div></li>
</ul>

<h3 id="cli-exemples">CLI Exemples</h3>

<ul>
<li><p>If you want to install only a minion which will be connected to a remote
mastersalt master:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>./boot-salt.sh
</code></pre></div></li>

<li><p>If you want to manage from end to end your server, select also the <code>laptop</code> preset nodetype:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>./boot-salt.sh -n laptop<span class="p">|</span>server<span class="p">|</span>kxccontainer<span class="p">|</span>vm
</code></pre></div></li>
</ul>

<p>To skip the automatic code update/upgrade:</p>
<div class="highlight"><pre><span></span>```sh
./boot-salt.sh -S
```
</pre></div>

<p>To switch on a makina-states branch, like the <strong>v2</strong> branch in
production:</p>
<div class="highlight"><pre><span></span>```sh
./boot-salt.sh -b v2
```
</pre></div>

<h4 id="upgrade">Upgrade</h4>

<ul>
<li><p>Upgrade will:</p>

<ul>
<li>Run predefined &amp; scheduled upgrade code</li>
<li>Update makina-states repositories in /srv/salt &amp; /srv/makina-states</li>
<li>Update core repositories (like salt code source in /srv/makina-states/src/salt)</li>
<li>Do the highstates (salt and masterone if any)</li>
</ul>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>boot-salt.sh -C --highstates
</code></pre></div></li>
</ul>

<h3 id="activating-another-nodetype-preset-after-installation">Activating another nodetype preset after installation</h3>

<ul>
<li><p>If you installed the <strong>scratch</strong> preset and want to switch to another preset:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>salt-call state.sls makina-states.nodetypes.&lt;your_new_preset&gt;
</code></pre></div></li>

<li><p>If you installed a preset and want to switch to another preset:</p>

<ul>
<li>edit <strong>etc/makina-states/nodetype</strong> and put your new preset</li>
<li>edit <strong>etc/makina-states/nodetypes.yaml</strong> and set to false your old preset</li>

<li><p>Finally, run:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>salt-call state.sls makina-states.nodetypes.&lt;your_new_preset&gt;
</code></pre></div></li>
</ul></li>
</ul>

		</div><div class="last-modified">Last Updated: 0001-01-01</div>
<footer id="content-footer">


<a href="/topics/haproxy/" class="cf-link prev-page">
			<i class="fa fa-chevron-left"></i>
		<div class="page-info">
			<span>Previous</span>
			<h5 class="topics">Haproxy</h5>
		</div>
</a>


	<a href="/topics/ssl/" class="cf-link next-page">
		<div class="page-info">
			<span>Next</span>
			<h5 class="topics">Manage ssl certificates</h5>
		</div>
		<i class="fa fa-chevron-right"></i>
	</a>


</footer>
</article>
</main>

<aside id="toc" class="scroll-fixed-wrapper">
  <div class="scroll-fixed-wrapper-inner">
    <header class="toc-header">
      <a href="#installation--basic-usage">
        <h3 class="topics">Installation &amp; basic usage</h3>
      </a>
    </header>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#briefing">Briefing</a></li>
<li><a href="#reminder">Reminder</a></li>
<li><a href="#details">Details</a></li>
<li><a href="#regular-modes-via-boot-salt-sh">Regular modes (via boot-salt.sh)</a>
<ul>
<li><a href="#download">Download</a></li>
<li><a href="#cli-exemples">CLI Exemples</a>
<ul>
<li><a href="#upgrade">Upgrade</a></li>
</ul></li>
<li><a href="#activating-another-nodetype-preset-after-installation">Activating another nodetype preset after installation</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
  <div class="fade"></div>
</aside>
<a href="#"
  id="toc-toggle"
  class="toc-open"
  title="Toggle Table of contents..."></a>


	</div>
<footer id="site-footer" class="site-footer">
<div class="footer-content">
  
    
  </div>
</footer>
<div class="navbutton__wrapper">
  <a class="trigger" href="#">
    <ul class="nav__trigger">
      <li class="nav__trigger-item nav__trigger-item--first"></li>
      <li class="nav__trigger-item nav__trigger-item--second"></li>
      <li class="nav__trigger-item nav__trigger-item--third"></li>
    </ul>
  </a>
</div>
<nav class="site-navigation navigation-open scroll-fixed-wrapper"
     id="site-navigation">
  <div class="site-navigation-inner scroll-fixed-wrapper-inner">
    
    
    


<ul class="menu menu-1">

  
  
  


<li class="menu-item menu-item-1">
  <a
    class="list-icon menu-item-link menu-item-link-1" href="/sphinx/api">API</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-1">
  <a
    class="list-icon menu-item-link menu-item-link-1" href="/">Home</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-1">
  <a
    class="list-icon menu-item-link menu-item-link-1 has-children" href="/topics/">Topics</a>
  
  
  


<ul class="menu menu-2">

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/topics/ansible/">Ansible related configuration</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/topics/configure/">Configuration</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/topics/haproxy/">Haproxy</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2 active open" href="/topics/install/">Installation &amp; basic usage</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/topics/ssl/">Manage ssl certificates</a>
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/topics/database/">Minions managment via database.sls</a>
  
</li>

  
  
  

</ul>

  
  
</li>

  
  
  

  
  
  


<li class="menu-item menu-item-1">
  <a
    class="list-icon menu-item-link menu-item-link-1 has-children" href="/cloud/">Cloud</a>
  
  
  


<ul class="menu menu-2">

  
  
  


<li class="menu-item menu-item-2">
  <a
    class="list-icon menu-item-link menu-item-link-2" href="/cloud/lxc/">LXC containers management</a>
  
</li>

  
  
  

</ul>

  
  
</li>

  
  
  

</ul>

    
  </div>
</nav>
<script src="/js/vendor/jquery-2.2.4.min.js"></script>
<script src="/js/vendor/lunr.min.js"></script>
<script src="/js/script.min.js"></script>



<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>
(function() {
  if (window.location.hostname === "localhost") {
    console.log("Analytics not running on local dev.");
    return;
  } else {
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
    ga('create', '', {
      'siteSpeedSampleRate': 100
    });
  }
})();
</script>

	
</body>
</html>
